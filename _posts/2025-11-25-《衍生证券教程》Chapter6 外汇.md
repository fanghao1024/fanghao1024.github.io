---

layout: post
title: "《衍生证券教程》第六章 外汇 笔记"
description: ""
author:     "Hao"
category: true
tagline: "衍生品"
tags: [finance math , derivative pricing]

---

格式更好的html版本](https://www.fanghao.work/2025/11/25/%E8%A1%8D%E7%94%9F%E8%AF%81%E5%88%B8%E6%95%99%E7%A8%8B-Chapter6-%E5%A4%96%E6%B1%87/)

设X(t)表示t时的汇率，等于1单位外币折算的本币单位数。
需要牢记X(t)表示外币的价格，就像股票价格一样来理解汇率。如果用S表示外币计价的外国资产价格，则乘以汇率得出以本币计价的资产价格，即$X(t)S(t)$

## 货币期权
==汇率很类似于股票价格，而外国无风险利率相当于红利支付。==
因此可以采用BS公式来对汇率看涨期权和看跌期权进行定价：
+ 资产价格=X(0)
+ 无风险利率=r
+ 波动率=$\sigma_x$
+ 红利支付率=$r_f$。

## 执行价格以外币计价的外国资产期权
将BS公式得出的价格乘以当前汇率，得出以本币计价的外国资产期权的价格。

## 执行价格以本币计价的为外国资产期权
执行价格K以本币计价、标的资产价格为S的看涨期权在到期日T的回报函数为
$$
	\max(X(T)S(T)-K,0)
$$
标的资产价格$X(T)S(T)$是投资组合以本币计价的价格，该投资组合开始时由$e^{-qT}$单位的资产组成，到期日T之前的红利进行再投资。
用BS公式进行定价：
+ 资产出时价格取$e^{-qT}X(0)S(0)$，红利支付率为0(或资产初始价格取为X(0)S(0)，将红利支付率取为q)。
+ 波动率取为本币家家的价格$e^{-q(T-t)}X(t)S(t)$的波动率，该波动率与$X(t)S(t)$的波动率相同。
  本币计价价格XS的波动率为
  $$
  \sigma=\sqrt{\sigma_x^2+\sigma_s^2+2\rho \sigma_x \sigma_y} \tag{6.1}
  $$

执行价格以本币计价的外国资产看涨期权、看跌期权可以用BS公式进行定价，公式中的输入参数为：
+ 资产初始价格=$X(0)S(0)$
+ 无风险利率=r
+ 波动率=$\sqrt{\sigma_x^2+\sigma_s^2+2\rho \sigma_x \sigma_y}$
+ 红利支付率=q

## 货币远期和货币期货
最活跃的货币市场是银行间远期市场，但也有在交易所交易的期货合约。
远期合约和期货合约的区别在于期货合约采用逐日“盯市”制度，因此，每天都伴有期货合约的现金流，而远期合约的现金流只在合约期发生。两种合约在买卖当日都没有现金流发生，因此买卖日的合约价值等于0.
在连续盯市的假设下，如果存在一个不变的（本国）无风险利率--或者更为一般地，存在一个随时间变化但非随机的瞬时无风险利率，期货价格必定等于无套利下的远期价格。

以可交易资产为标的的远期合约，总可以通过如下交易简单地合成：借入资金，买入并持有该资产，用借入资金提供存储成本，这里假定存储成本可以预先估计。如果资产支付红利或者产生其他正现金流，则没有必要全额购买对冲远期合约的标的资产，因为将红利进行再投资可以获得额外的资产。货币资产没有存储成本，其红利支付率等于外国无风险利率。

以单位外币为标的、到期日为T的远期合约可以通过如下交易来合成：
    在0时买入$e^{-r_f T}$单位外币，以本国无风险利率借入所需资金$X(0)e^{-r_f T}$，由此产生T时一单位外币的权益，而T时的负债为$e^{(r-r_f)T}X(0)$，其中包括了利息支付。因此，0时的远期价格必定等于$F(0)=e^{(r-r_f)T}X(0)$，否则，通过买入远期合约、“卖出”合成的远期或者相反的操作可以进行套利。
    更一般的，关系式（6.2）称为“抛补利率平价”。
    ==到期日为T的远期合约在t时的价格必定等于==
$$
      F(t)=e^{(r-r_f)(T-t)}X(t) \tag{6.2}
$$

$$
    \begin{align*}
    \text{货币远期多头}&=\text{合成货币远期多头}\\
    &=\text{外国无风险资产多头}+\text{本国无风险资产空头}
    \end{align*}
$$
减去一个空头头寸等于加上一个多头头寸，以此对上式进行重新整理可以得出
$$
\text{货币远期多头}+\text{本国无风险资产多头}=\text{外国无风险资产多头}
$$


$$
e^{r_f(T-t)}\text{的货币远期多头}+X(t)\text{的本国无风险资产多头}=\text{投资于外国无风险资产的1单位外汇多头} \tag{6.3}
$$

## Quanto
"quota"是一种以外国资产为标的的衍生产品，外国资产的价值以固定汇率转换为本国货币计价。合约的支付采用本国货币，汇率是合约内容的一部分。这种合约在未来时间T支付一份外国资产，支付按照固定汇率转换为本国货币进行。
这种合约非常适合以外国资产为投资对象而由不愿意承受汇率风险的投资者。
当投资者购买了一份quanto后，汇率风险对冲问题就转嫁给了合约的卖方。

问题：在时间T支付$\bar{X}S(T)$的合约在0时的价值，其中$\bar{X}$表示固定利率。
解：
    一般来讲，对这类问题最好的解决方法是先对合约进行定价，然后计算复制策略。
   ==通过选择恰当的计价物从而消除合约回报函数中的随机性，能够简化合约的定价。==
   显然，计价物必须是无红利支付的（国内）资产价格，因此可以选择$Z(t)=X(t)e^{qt}S(t)$作为计价物资产价格，该价格是以本国货币计价的如下策略t时的价值：在0时持有一单位外国资产多头并将红利进行再投资购买新的股份。
详细解释Quanto合约定价推导过程。整个推导旨在计算一个Quanto合约在时间0的价值，该合约在时间T支付 $\bar{X}S(T)$，其中 $\bar{X}$是固定汇率，S(T)是外国资产在时间T的价格。推导使用了风险中性定价理论、伊藤引理以及改变测度的方法。下面将分步骤解释推导的关键环节。

### 第一步：Quanto合约概述和定价目标

- **Quanto合约定义**：Quanto是一种衍生品，它以固定汇率 $\bar{X}$将外国资产价值 S(T)转换为国内货币支付。这意味着投资者在时间T收到 $\bar{X}S(T)$单位国内货币，而不承担汇率风险。
- **定价目标**：找到合约在时间0的价值，即计算 $V(0)=价值[\bar{X}S(T)]$。

### 第二步：选择计价单位（Numeraire）

为了简化估值，推导选择了一个合适的计价单位 Z(t)。计价单位是一个非分红资产的价格过程，用于改变测度。

- **计价单位定义**：$Z(t)=X(t)e^{qt}S(t)$，其中： X(t)是汇率（一单位外国货币的国内价格）， S(t)是外国资产价格， q是资产的连续股息率， $e^{qt}$表示股息再投资。
- Z(t)代表以国内货币计值的外国资产价值，其中股息被再投资。选择 Z(t)作为计价单位可以简化期望计算。
#### 关于计价物的选取
这是一个非常深刻的问题，它触及了金融工程中衍生品定价最核心、最精妙的技巧之一：**通过选择合适的计价单位来简化定价问题。**

选择 $Z(t)=X(t)e^{qt}S(t)$并不是凭空猜测，而是一个经过深思熟虑的、目标明确的策略。其背后的思考过程可以分为以下几个逻辑层次：

step1 明确目标——简化期望表达式

Quanto合约在到期日T的支付是$\bar{X}S(T)$（单位：本币）。根据风险中性定价理论，其当前价值为：
$$
V(0)=e^{−rT}E^Q[\bar{X}S(T)]
$$
其中 Q是本币风险中性测度。直接计算这个期望非常复杂，因为它涉及到两个相关的随机变量 S(T)和 X(T)（虽然支付函数里没有直接出现 X(T)，但 S(T)的动态过程在 Q测度下是依赖于 X的风险的）。
>💰 理解“本币风险中性测度 (Q)”
首先，所谓的“本币风险中性测度”（通常记为 Q），是一个为了简化定价而构造的“理论世界”。在这个世界里，所有投资者都是风险中性的，他们不要求对承担风险提供额外的补偿。因此，任何资产（以本币计价）的预期收益率都等于本国的无风险利率 r。
资产定价基本定理指出，在一个无套利的市场中，存在这样一个等价鞅测度。在这个测度下，任何资产的贴现价格过程是一个鞅（Martingale）——即未来的期望值等于当前值 。这意味着，一个衍生品的当前价格，就等于在 Q测度下对其未来收益进行贴现后的期望值。
🌍 外国资产的“本币视角”与汇率风险
     现在来看问题中的主角：外国资产价格 S(T)。它本身是以外国货币计价的。
	 关键转换：当一位本国投资者想要为这个外国资产定价时，他真正关心的是其以本国货币计算的价值。这个价值等于外国资产价格乘以汇率，即 X(T)⋅S(T)。
	 风险来源：因此，S(T)的本币价值受到两种风险的共同影响：
    	1.资产价格风险：S(T)本身以外币计价的价格波动。
    	2.汇率风险：汇率 X(T)的波动，即外国货币相对于本国货币价值的变动。
	所以，即使在风险中性的 Q测度下，我们也无法忽略汇率风险，因为它直接影响最终的本币收益。
🔗 为何在 Q 测度下 S(T) 的动态会依赖 X 的风险？
	这是最精妙的一点。在真实的物理世界（P测度）中，S(T)的动态过程由其自身的风险因素驱动。但是，当我们通过**测度变换**进入到**本币风险中性测度（Q测度）** 时，资产价格过程的漂移项会发生改变。
	变换的实质：测度变换可以理解为一种“概率分布的扭曲”，它改变了不同路径发生的概率权重，其目的是确保所有以本币计价的贴现资产价格都成为鞅。这个变换过程，例如通过Girsanov定理实现，会为资产价格的随机过程引入一个漂移调整项。
	调整项的核心：这个调整项的大小，正比于该资产收益率与计价单位资产收益率之间的瞬时协方差。在Quanto合约的背景下，当我们切换到本币风险中性测度时，外国资产 S的动态过程所依赖的随机冲击（布朗运动）与汇率 X的随机冲击之间的相关性 ρ，就会通过这个协方差项进入 S的漂移调整中 。
	最终结果：经过测度变换后，在 Q测度下，外国资产价格 S所遵循的随机微分方程（SDE）的漂移率不再仅仅是其真实世界的预期收益率  $μ_S$ ，而是变成了 $r_f−ρσ_X σ_S$（其中 r_f是外国无风险利率）。请注意，新的漂移率中包含了 $−ρσ_X σ_S$这一项。这一项明确地包含了汇率的波动率 $σ_X$和两者间的相关系数 ρ。
💎 总结
	因此，“在本币风险中性测度下，S(T)的动态过程在 Q测度下是依赖于 X的风险的”这句话可以这样理解：
		当我们从本国投资者的视角（本币风险中性测度 Q）为外国资产 S定价时，为了确保定价体系的无套利性，必须对 S的真实动态过程进行概率测度的变换。这个变换会导致 S在 Q测度下的期望增长率（漂移项）发生调整，而调整量恰好包含了它与汇率 X的波动率和相关性。这意味着，即使在我们抽象出的“风险中性世界”里，外国资产价格未来的演化路径，在概率上依然与汇率风险紧密绑定。
这就好比说，在为本国投资者构建的理论定价框架中，外国资产的“命运”依然无法摆脱汇率波动的影响。这也是Quanto期权定价公式中出现 $−ρσ_X σ_ST$这一调整项的根本原因。
>
定价的核心技巧是**改变计价单位**。通用公式为：
$$
V(0)=N(0)⋅E^{Q^N}[\frac{V(T)}{N(T)}]
$$
这里，N(t)是你选择的计价单位资产的价格，$Q^N$是对应的风险中性测度。

**我们的目标变得非常明确：选择一个聪明的 N(t)，使得新的期望表达式 $E^{Q^N}[\frac{\bar{X}S(T)}{N(T)}]$变得极其简单，最好是常数或者只依赖于一个变量。**

step2 分析支付结构，寻找“天然”的计价单位

我们盯着支付函数 $ \bar{X}S(T)$ 看。它本质上是“一份外国资产S，但其价值被一个固定汇率$ \bar{X}$转换成了本币”。

一个很自然的想法是：**有没有一种资产，它的终值 N(T)和支付 V(T)在结构上非常相似？** 如果有，那么它们的比值 V(T)/N(T)就可能被简化。

- 支付是 $\bar{X}S(T)$。

- 如果我们构造一个资产组合：**持有这份外国资产 S(t)，并将其产生的连续股息 q 进行再投资，那么这个组合的外币价值就是 $e^{qt}S(t)$。再将这个外币价值通过即期汇率 X(t)转换成本币，那么这个本币价值正是：**
  $$
  N(t)=X(t)⋅[e^{qt}S(t)]=X(t)e^{qt}S(t)
  $$
  这就是 Z(t)的金融含义！它代表的是“1单位外国资产S，并将其股息再投资后，所对应的本币价值”。

step3 验证选择 Z(t)作为计价单位的效果

现在，我们将 Z(t)作为计价单位 N(t)代入定价公式：
$$
V(0)=Z(0)⋅E^{Q^Z}[\frac{\bar{X}S(T)}{Z(T)}]
$$


接下来就是见证奇迹的时刻。我们代入 $Z(T)=X(T)e^{qT}S(T)$：
$$
\frac{\bar{X}S(T)}{Z(T)}=\frac{\bar{X}S(T)}{X(T)e^{qT}S(T)}=\frac{\bar{X}}{X(T)}e^{−qT}
$$
这个简化是革命性的：

1. **资产价格 S(T)被完全消掉了！**
2. 复杂的、涉及两个相关随机变量 S(T)和 X(T)的联合分布问题，**被简化成了一个只关于单一随机变量 X(T)的问题**。
3. $\bar{X}$和$ e^{−qT}$是常数，可以提到期望外面。

于是，定价公式简化为：
$$
V(0)=Z(0)e^{−qT}\bar{X}⋅E^{Q^Z}[\frac{1}{X(T)}]=e^{−qT}\bar{X}S(0)X(0)⋅E^{Q^Z}[\frac{1}{X(T)}]
$$
step4 思考过程的总结

所以，选择 $Z(t)=X(t)e^{qt}S(t)$的思考逻辑是：

1. **核心目标驱动**：目标不是随便选一个资产，而是选一个能让比值 V(T)/N(T)最大程度简化的资产。
2. **逆向工程/模式匹配**：仔细审视支付函数 $\bar{X}S(T)$的结构，逆向构造一个在形态上与之高度相似的资产组合 Z(t)。
3. **金融直觉**：Z(t)有清晰的金融解释——它是标的资产S的本币价值（含股息再投资）。用这个资产作为衡量Quanto合约价值的“尺子”（计价单位）是再自然不过的事情，因为它与合约本身所代表的风险暴露高度一致。
4. **数学验证**：代入后，数学上的简化效果立竿见影，证明了该直觉的正确性。复杂的两变量问题降维成了更易处理的单变量问题。

**总而言之，这不是一个偶然的发现，而是一个经典的“配方法”思想在金融工程中的应用：通过构造一个恰当的“分母”来消去“分子”中的复杂项。** 这种选择计价单位的技巧在奇异期权定价中至关重要，Quanto期权是展示其威力的最佳范例之一。
### 第三步：应用风险中性定价公式

在风险中性定价框架下，合约价值为：

$$
V(0)=Z(0)⋅E^Z[Z(T)\frac{\bar{X}S(T)}{Z(T)}]
$$


其中 $E^Z$表示在 Z作为计价单位的测度下的期望。

代入 $Z(T)=X(T)S(T)e^{qT}$和 Z(0)=X(0)S(0)（因为 $e^{q⋅0}=1$），我们简化表达式：

$$
V(0)=X(0)S(0)⋅E^Z[\frac{\bar{X}S(T)}{X(T)S(T)e^{qT}}]=e^{−qT}\bar{X}S(0)⋅E^Z[\frac{X(0)}{X(T)}] \tag{6.4}
$$
因此，关键变为计算期望 $E^Z[\frac{X(0)}{X(T)}]$。

### 第四步：计算期望 $E^Z[\frac{X(0)}{X(T)}]$

目标是证明：

$$
E^Z[\frac{X(0)}{X(T)}]=\exp{(r_f−r−ρσ_xσ_s)T} \tag{6.5}
$$


其中：

- $r_f$是外国无风险利率，
- r是国内无风险利率，
- $σ_x$是汇率 X的波动率，
- $σ_s$是资产价格 S的波动率，
- ρ是X和S的相关系数。

#### 假设动力学过程

假设 X和 S遵循几何布朗运动：

$$
\frac{dX}{X}=μ_xdt+σ_xdB_x\\
\frac{dS}{S}=μ_sdt+σ_sdB_s
$$


其中 $B_x$和 $B_s$是相关性为 ρ的布朗运动（即 $dB_xdB_s=ρdt$）。$μ_x$和 $μ_s$是随机漂移项，但在风险中性测度下会被调整。

#### 计价单位 Z的动力学

首先，求 $Z(t)=X(t)S(t)e^{qt}$的随机微分方程。应用伊藤引理：

$$
\frac{dZ}{Z}=qdt+\frac{d(XS)}{XS}
$$


其中 $\frac{d(XS)}{XS}$可以通过乘积规则计算：

$$
\frac{d(XS)}{XS}=\frac{dX}{X}+\frac{dS}{S}+\frac{dX}{X}\frac{dS}{S}=(μ_x+μ_s+ρσ_xσ_s)dt+σ_xdB_x+σ_sdB_s
$$


因此：

$$
\frac{dZ}{Z}=(q+μ_x+μ_s+ρσ_xσ_s)dt+σ_xdB_x+σ_sdB_s
$$


定义组合波动率 σ和新布朗运动 B，使得：

$$
σdB=σ_xdB_x+σ_sdB_s,σ^2=σ_x^2+σ_s^2+2ρσ_xσ_Fs
$$


则：

$$
\frac{dZ}{Z}=(q+μ_x+μ_s+ρσ_xσ_s)dt+σdB
$$


B是一个布朗运动，σ是 Z的波动率。同时，X和Z的瞬时变化率的相关系数为：

$$
\frac{dBdBx}{dt}=\frac{σ_x+ρσ_s}{\sigma}
$$

> 相关系数的计算
>
> X和Z的瞬时变化率的相关系数定义为：
> $$
> \rho_{X,Z}=\frac{Cov(\frac{dX}{X},\frac{dZ}{Z})}{\sqrt{Var(\frac{dX}{X})Var(\frac{dZ}{Z})}}
> $$
> 分母部分：
> $$
> Var(\frac{dX}{X})=\sigma_X^2 dt, \\
> Var(\frac{dZ}{Z})=\sigma_Z^2 dt
> $$
> 分子协方差（忽略漂移项，因协方差只涉及波动部分）
> $$
> Cov(\frac{dX}{X},\frac{dZ}{Z})=Cov(\sigma_XdB_X,\sigma_ZdB_Z)=\sigma_X \sigma_Z Cov(dB_X,dB_Z)
> $$
> 计算$Cov(dB_X,dB_Z)$
> $$
> \begin{aligned}
> Cov(dB_X,dB_Z)&=E[dB_x dB_Z]\\
> &=E[dB_X(\frac{\sigma_X}{\sigma_Z}dB_X+\frac{\sigma_S}{\sigma_Z}dB_S)]\\
> &=\frac{\sigma_X}{\sigma_Z}dt+\frac{\sigma_S}{\sigma_Z}\rho dt\\
> &=\frac{σ_x+ρσ_s}{\sigma_Z}dt
> \end{aligned}
> $$
> 因此：
> $$
> Cov(\frac{dX}{X},\frac{dZ}{Z})=\sigma_X \sigma_Z Cov(dB_X,dB_Z)=\sigma_X(\sigma_X+\rho\sigma_S)dt
> $$
> 带入相关系数公式
> $$
> \rho_{X,Z}=\frac{\sigma_X(\sigma_X+\rho\sigma_S)dt}{\sqrt{\sigma_X^2 dt \cdot \sigma_Z^2 dt}}=\frac{\sigma_X(\sigma_X+\rho\sigma_S)}{\sigma_X \sigma_Z}=\frac{\sigma_X+\rho\sigma_S}{\sigma_Z}
> $$
> 其中$\sigma_Z=\sqrt{\sigma_X^2+\sigma_S^2+2\rho \sigma_X \sigma_S}$

#### 改变测度到 Z测度

现在，我们需要在Z作为计价单位的测度下，找到X的漂移项。使用教材中的公式（2.29）。将 X视为一种资产，其股息率为 $r_f$（因为汇率 X代表外国货币价格，外国货币的无风险利率相当于股息率）。

公式（2.29）指出：当使用风险资产 Z作为计价单位时，另一个资产 X的漂移调整为：

$$
\frac{dX}{X}=(r−r_f+σ_x^2+ρσ_xσ_s)dt+σ_xdB_x^∗
$$


其中 $B_x^∗$是 Z测度下的布朗运动。这里：

- r是国内无风险利率，
- $r_f$是外国无风险利率，
- $σ_x^2$是 X的方差项，
- $ρσ_xσ_s$是相关性项。

#### 计算 1/X的动力学

应用伊藤引理求 1/X。令 Y=1/X，则：

$$
\frac{dY}{Y}=−\frac{dX}{X}+(\frac{dX}{X})^2
$$


代入 XdX：

$$
\frac{dY}{Y}=−[(r−r_f+σ_x^2+ρσ_xσ_s)dt+σ_xdB_x^∗]+σ_x^2dt
$$


简化漂移项：

$$
\frac{dY}{Y}=[−r+r_f−σ_x^2−ρσ_xσ_s+σ_x^2]dt−σ_xdB_x^∗=(r_f−r−ρσ_xσ_s)dt−σ_xdB_x^∗
$$
因此，在 Z测度下，Y=1/X是一个几何布朗运动，其增长率为 $r_f−r−ρσ_xσ_s$。

#### 计算期望

对于几何布朗运动，有：

$$
E^Z[\frac{1}{X(T)}]=\frac{1}{X(0)}\exp\{(r_f−r−ρσ_xσ_s)T\}
$$


因此：

$$
    E^Z[\frac{X(0)}{X(T)}]=X(0)⋅\mathbb{E}^Z[\frac{1}{X(T)}]=\exp\{(r_f−r−ρσ_xσ_s)T\}
$$
这就证明了公式（6.5）。
> 关于如何从随机微分方程（SDE）推导出期望的解析解。这个过程的关键在于识别出随机微分方程描述了一个**几何布朗运动**，然后直接应用几何布朗运动的性质来求解期望。
>
> 下面我们来一步步详细解释。
>
> ### 第一步：识别随机微分方程的类型
>
> 您给出的随机微分方程为：
> $$
> \frac{dY}{Y}=(r_f−r−ρσ_xσ_s)dt−σ_xdB_x^{∗∗}
> $$
>
>
> 其中 $Y=\frac{1}{X}$。
>
> 这个方程具有标准几何布朗运动（Geometric Brownian Motion）的形式：
> $$
> \frac{dS_t}{S_t}=μdt+σdBt
> $$
>
>
> 对比可知：
>
> - **漂移率（μ）** 为 $μ_Y=r_f−r−ρσ_xσ_s$
> - **波动率（σ）** 为 $σ_Y=σ_x$（方程中的负号不影响波动率的大小，只表示与布朗运动的方向相反，在计算期望值时，这个符号差异没有影响，因为标准正态分布的对称性会将其抵消）
>
> 因此，变量 Y在测度 Z下遵循一个漂移率为 $μ_Y$、波动率为 $σ_Y$的几何布朗运动。
>
> ### 第二步：写出几何布朗运动的解
>
> 对于一个服从 $\frac{dS_t}{S_t}=μdt+σdBt$的几何布朗运动，其解析解（在时刻 T的值）由伊藤引理给出，形式为：
> $$
> S_T=S_0\exp[(μ−\frac{1}{2}σ^2)T+σB_T]
> $$
>
>
> 将我们的变量 Y及其参数代入这个通解公式，得到 Y在时刻 T的解为：
> $$
> Y(T)=Y(0)\exp[(μ_Y−\frac{1}{2}σ_Y^2)T−σ_XB^{∗∗}(T)]
> $$
>
>
> 由于 $σ_Y=σ_X$，上式可写为：
> $$
> Y(T)=Y(0)\exp[(r_f−r−ρσ_xσ_s−\frac{1}{2}σ_x^2)T−σ_XB^{∗∗}(T)]
> $$
>
>
> ### 第三步：计算期望值 $E^Z[Y(T)]$
>
> 我们需要计算的是 $E^Z[Y(T)]$。将上述表达式代入：
> $$
> E^Z[Y(T)]=Y(0)\exp[(r_f−r−ρσ_xσ_s−\frac{1}{2}σ_x^2)T]⋅E^Z[\exp(−σ_xB^{∗∗}(T))]
> $$
>
>
> 现在，核心是计算期望 $E^Z[\exp(−σ_xB^{∗∗}(T))]$。
>
> 在测度 Z下，$B^{∗∗}(T)$是一个标准布朗运动在时刻 T的取值，因此 $B^{∗∗}(T)∼N(0,T)$，即服从均值为0、方差为 T的正态分布。
>
> 对于一个服从正态分布 N(0,T)的随机变量 X，其矩母函数（Moment Generating Function）为：
> $$
> E[\exp(kX)]=\exp(\frac{1}{2}k^2T)
> $$
>
>
> 在我们的式子中，$k=−σ_x，X=B^{∗∗}(T)$。因此：
> $$
> E^Z[\exp(−σ_xB^{∗∗}(T))]=\exp(\frac{1}{2}(−σ_x)^2T)=\exp(\frac{1}{2}σ_x^2T)
> $$
>
>
> ### 第四步：合并结果
>
> 将矩母函数的结果代回期望表达式：
> $$
> \begin{aligned}
> E^Z[Y(T)]&=Y(0)\exp[(r_f−r−ρσ_xσ_s−\frac{1}{2}σ_x^2)T]⋅\exp(\frac{1}{2}σ_x^2T)\\
> &=Y(0)\exp[(r_f−r−ρσ_xσ_s−\frac{1}{2}σ_x^2+\frac{1}{2}σ_x^2)T]\\
> &=Y(0)\exp[(r_f−r−ρσ_xσ_s)T]
> \end{aligned}
> $$
>
>
> 因为 $Y(T)=\frac{1}{X(T)}$且 $Y(0)=\frac{1}{X(0)}$，所以最终得到：
> $$
> E^Z[\frac{1}{X(T)}]=\frac{1}{X(0)}\exp{(r_f−r−ρσ_xσ_s)T}
> $$
>
>
> ### 总结
>
> 这个推导过程的本质是：一旦确定一个随机过程遵循**几何布朗运动**，其期望值在任意未来时刻都有一个简洁的闭式解，即 $E[S_T]=S_0e^{μT}$。

### 第五步：代入得到合约价值

将期望代入价值公式：

$$
V(0)=e^{−qT}\bar{X}S(0)⋅\exp\{(r_f−r−ρσ_xσ_s)T\}=\exp\{(r_f−r−q−ρσ_xσ_s)T\}\bar{X}S(0) \tag{6.6}
$$
这就是最终的Quanto合约价值公式（6.6）。

### 总结

推导过程的关键点：

- **计价单位选择**：$Z(t)=X(t)e^{qt}S(t)$简化了支付随机性的处理。
- **测度变换**：通过改变到 Z测度，将问题转化为计算 1/X的期望。
- **伊藤引理**：用于推导 Z和 1/X的动力学。
- **几何布朗运动性质**：直接给出期望的闭式解。

这个推导展示了如何对含有汇率风险的衍生品进行定价，并对冲策略提供了基础。

## Quanto的复制
==复制策略的核心目的：通过构造由可交易资产（如风险资产、无风险资产）组成的动态组合，使得该组合在时刻T的现金流（或收益）与目标证券在T的现金流（或收益）完全一致。==
在对回报$\bar{X}S(T)$进行复制时，可以利用的资产包括·价格为S的外国资产、外国无风险资产和本国无风险资产。
在计算之前，首先给出一些直观事实：
+ 回报$\bar{X} S(T)$对外国资产价格S具有风险暴露，故复制组合中必须包含外国资产多头
+ 回报$\bar{X}S(T)$对汇率不存在风险暴露，故复制组合不存在对汇率的风险暴露。外国风险资产的多头头寸必须用相同数量的外国无风险资产空头头寸对冲
+ 基于上面的事实，复制组合的价值，即由（6.6）给出价值，等同于在本国无风险资产上的投资。

由此可以看出，真正需要计算的是应该持有的外国资产的份额，该份额一旦确定，复制组合中的其余部分也被确定。
复制组合在任何时间 $t(t \leq T)$ 的价值必须等于T时回报 $\bar{X} S(T)$。我们已经计算出了0时的价值，并且很显然，如果用T-t代替到期时间T，用资产价格S(t)代替S（0），则公式（6.6）对任何时间t都成立。由此得出，组合在任何时间 $t(t\leq T)$ 的价值V(T)必须为
$$
V(t)=\exp \{(r_f-r-q-\rho \sigma_x \sigma_s)(T-t) \}\bar{X}S(t) \tag{6.7}
$$
如前所述，在时间t，我们需要同样数量的本国无风险资产投资。剩下要做的是计算外国风险资产的多头头寸和用于对冲的外国无风险资产的空头头寸。
由Ito公式得出
$$
\frac{dV}{V}=-(r_f-r-q-\rho \sigma_x\sigma_s)dt+\frac{dS}{S} \tag{6.8}
$$
或者等价地
$$
dV=(r+q-r_f+\rho \sigma_x\sigma_s)Vdt+V\frac{dS}{S} \tag{6.9}
$$
另一方面，考虑投资组合：将a(t)单位的本国货币投资于外国资产，b(t)单位的本国货币投资于外国无风险资产，c(t)单位的本国货币投资于本国无风险资产。设$W=a+b+c$ 表示投资组合价值。
+ 投资于外国资产的单位本国货币的收益为
$$
\begin{aligned}
	\frac{d(Xe^{qt}S)}{Xe^{qt}S}&=qdt+\frac{dX}{X}+\frac{dS}{S}+(\frac{dX}{X})(\frac{dS}{S})\\
	&=(q+\rho \sigma_x\sigma_s)dt+\frac{dX}{X}+\frac{dS}{S}
\end{aligned} \tag{6.10}
$$
+ 投资于外国无风险资产的收益率为
$$
\frac{d(e^{r_f t}X)}{e^{r_f t}X}=r_f dt+\frac{dX}{X} \tag{6.11}
$$
+ 投资于本国无风险资产的收益率为
$$
rdt
$$

由此得出，投资组合价值的变化量为
$$
\begin{aligned}
dW&=a[(q+\rho\sigma_x\sigma_s)dt+\frac{dX}{X}+\frac{dS}{S}]+b[r_f dt+\frac{dX}{X}]+crdt\\
&=(aq+a\rho\sigma_x\sigma_s+br_f+cr)dt+(a+b)\frac{dX}{X}+a\frac{dS}{S}
\end{aligned} \tag{6.12}
$$
要使投资组合价值变化量（6.12）等于V的变化量（6.9），当且仅当
$$
a=V,b=-V,c=V \tag{6.13}
$$

由此得出：

对T时回报 $\bar{X}S(T)$ 进行复制的策略，是将V(T)单位的本国货币投资于外国资产，其中$V(t)$由（6.7）定义。该投资购买的外国资产份额为：
$$
\frac{V}{X(t)S(t)}=\frac{\bar{X}}{X(t)}\exp\{ (r_f-r-q-\rho \sigma_x\sigma_s)(T-t)\} \tag{6.14}
$$
用于投资的头寸全部以外国无风险利率借入。同时，将与$V(t)$数量相同的本国货币投资于本国无风险资产。

由上节可知，复制策略中的外国无风险自查可以用货币远期代替,相应的复制策略中涉及以外国无风险利率借入，因此应该将（6.3）中的“多头”用”空头”代替。借入$V(t)$单位的本国货币相当于借入$V(t)/X(t)$单位的外币。因此，从（6.3）得出

对T时回报$\bar{X}S(T)$进行复制的一个等价策略，是在时间t将V(t)单位的本国货币投资于外国资产，同时持有$e^{r_f (T-t)}V(t)/X(t)$数量的货币远期空头头寸。

有一点需要注意，复制策略需要连续不断地买入和卖出货币远期，与需要连续不断地对外国资产进行交易一样。在t时将s<t时售出的远期合约买回，将注销s时售出的远期合约的交易义务，并在到期日T产生一个收入/支出现金流$F(s)-F(t)$。因此复制策略在T时产生的是资产还是负债，依赖于远期合约价格的变动方向。另一方面，随着时间的推移，为保持V(t)数量的外国资产投资而对资产进行买卖时，会产生相应的现金流。（6.14）表明，买还是卖依赖于汇率变动的方向。这些现金流应该进行再投资或者以本国无风险利率借入。因此，复制策略在时间T将会产生负债或者得到资产，这一点在上面文本框中给出的结论中并没有显示，与此同时，将会产生本国无风险资产上的投资或负债，这一点在文本框中的结论中也没有显示。
可以证明，这两项是相互抵消的：如果从远期合约交易中获利，则获利（更准确地说是获利现值）被用来购买外国资产而消耗掉，反之亦然。
## Quanto远期
从t时开始到T时到期，初始远期合约价格为$F^*(t)$的quanto远期合约多头在T时的回报函数为
$$
\bar{X}S(T)-F^*(t)
$$
远期合约价格$F^*(t)$应该使合约在t时的价值等于0。

要合成quanto远期合约，只需按复制策略买入，同时以国内无风险利率借入所需成本$V(t)$即可，由此产生的T时负债为$e^{r(T-t)}V(t)$。因此得出：
Quanto合约的价格为：
$$
F^*(t)=e^{r(T-t)}V(t)=\exp\{(r_f-q-\rho\sigma_x\sigma_s)(T-t)\bar{X}S(t)\} \tag{6.15}
$$

## quanto期权
考虑以外国资产为标的的欧式看涨期权，期权执行价格K以本国货币计价，外国资产的价格按固定汇率$\bar{X}$转换为本国货币计价。这样的期权称为=="quanto看涨期权"== 。
Quanto看涨期权在到期日T的价值为$\max(0,\bar{X}S(T)-K)$。
用（6.7）定义的价值为V的投资组合对回报$\bar{X}S(T)$进行复制：在T时的任何一种状态下，都有$V(T)=\bar{X}S(T)$。（6.8）给出了V的动态变化规律，从中可以看出V的波动率与S的波动率相同，因此在BS公式中可以以$\sigma_s$作为波动率的输入参数。此外，投资组合V是无红利支付（V是T时未定权益$\bar{X}S(T)$的价值,期间没有现金流发生），因此Black-Scholes公式中的红利支付率应该取0
> 通过构建一个复制组合V作为定价对象，核心目的就是为了**将复杂的、可能含有分红的Quanto期权，转化成一个标准的、无分红的看涨期权来定价，从而直接套用简单的布莱克-斯科尔斯公式。**
>
> 下面我们来详细拆解这个“转化”过程，以及它如何巧妙地规避了您提到的分红问题：
>
> ### 1. 问题的复杂性：直接给Quanto期权定价的困难
>
> 如果直接看待原始的Quanto期权，它的收益是 $max(0, \bar{X}S(T) - K)$。这里有几个复杂点：
>
> - **多随机源**：其价值依赖于两个随机变量：外国资产价格 `S(T)`（以外币计价）和到期时的即期汇率 `X(T)`。但在Quanto结构中，我们却用**固定汇率 $\bar{X}$**来换算。
> - **分红的处理**：如果外国资产 `S`支付股息，那么在期权存续期内，`S`的价格路径会因除息而跳跃，产生现金流。在定价时，必须精确建模这些股息的影响，这会大大增加模型的复杂性。
>
> ### 2. 解决方案：找到“完美替身”——复制组合V
>
> ==金融工程的常见思路是：如果一个衍生品太复杂，我们就想办法找到一个或创造出一个简单的、但最终收益完全相同的“替身”来为其定价。==
>
> - **替身是谁？** 这个“替身”就是文本中定义的**投资组合V**。它的精妙之处在于，无论世界如何变化，在到期日T，它都**精确地**满足 $V(T) = \bar{X}S(T)$。
> - **这意味着什么？** 这意味着： **Quanto期权的收益** =  $max(0, \bar{X}S(T) - K)$ **以V为标的的看涨期权收益** = `max(0, V(T) - K)` 因为 $V(T) = \bar{X}S(T)$，所以**这两个收益是完全一样的**。
>
> 因此，**今天这个Quanto期权的公平价格，就应该等于这个以V为标的的看涨期权的价格**。定价对象成功地从“Quanto期权”转换成了“基于V的标准看涨期权”。
>
> ### 3. 关键一步：为什么V是“无分红”的？
>
> 现在来到您最核心的疑问。组合V是如何规避掉S本身可能存在的分红问题的？
>
> 文本中的描述是关键：**“it is the value of a claim to ẊS(T) at date T with no interim cash flows”**（它是对T时刻价值为 ẊS(T) 的资产的索取权，且在到期前无中间现金流）。
>
> - V不是一个简单的“持有外国股票S”的组合。它是一个**动态管理的复制组合**。这个组合可能包含外国资产S、外汇远期/期货合约、本国和外国的债券等。
> - 它的管理目标是：**确保在到期日T那一刻，其价值恰好等于$\bar{X} × S(T)$**，而**不关心从0到T之间S价格路径的细节**（比如是否除息）。
> - **分红去哪了？** 如果S在时间t支付股息，那么直接持有S会收到现金股息。但在复制组合V中，这个股息现金流会在产生的瞬间就被组合的管理策略所处理掉——例如，立即用收到的股息现金再投资于S本身或其他组合成分，以保持复制策略的连续性。
> - **对持有者而言**：您持有的是这个组合V的份额，而不是直接持有S。您在整个过程中**不会收到**像股息这样的可自由支配的现金流出。V的价值变化是连续体现在其价格上的，所有收益（包括再投资的股息）都资本化在了V的价格里。
>
> 正因为V这个“替身”在存续期内**不产生需要投资者处理的现金流**，所以在应用布莱克-斯科尔斯公式时，才能将其视为一个“无分红”的资产。它的价格波动率与S相同（σ_S），但它的“股息率”输入值为0。
>
> ### 总结
>
> 所以，您的推测非常准确：
>
> 选择用复制组合V作为定价对象，正是金融工程中的一种典型“简化”技巧。它通过一个动态策略，将一个受汇率影响且基础资产可能分红的**双因素复杂衍生品**，完美地转化成了一个**单因素**的、**无分红**的**标准期权**。
>
> 这样，定价工作就从需要构建复杂的双因素模型，简化为直接查表或使用布莱克-斯科尔斯公式即可。这个“简化”的背后，是复制组合V的巧妙构建和其“无现金流”的特性。
由此得出：
Quanto看涨期权的价值为
$$
V(0)N(d_1)-e^{-rT}KN(d_2)=\exp\{(r_f-r-q-\rho\sigma_x\sigma_s)T\}\bar{X}S(0)N(d_1)-e^{-rT}KN(d_2) \tag{6.16}
$$
其中
$$
\begin{aligned}
d_1 &= \frac{\log\left(\frac{V(0)}{K}\right) + \left(r + \frac{1}{2}\sigma_s^2\right)T}{\sigma_s\sqrt{T}}\\
&= \frac{\log\left(\frac{\bar{S}(0)}{K}\right) + \left(r_f - q - \rho\sigma_x\sigma_s + \frac{1}{2}\sigma_s^2\right)T}{\sigma_s\sqrt{T}}
\end{aligned}\tag{6.17a}
$$
$$
d_2 = d_1 - \sigma_s\sqrt{T}  \tag{6.17b}
$$
类似的，quanto看跌期权的价格也可以由Black-Scholes给出：
$$
e^{-rT} K N(-d_2) - V(0) N(-d_1)
$$
注意，这个结果是以V(0)=资产初始价格、K=执行价格、r=利率、$\sigma_s$=波动率、0=红利支付率以及T=到期日 为输入通过Black-Scholes公式得到的。
可以用对冲普通看涨期权的方法对卖出的quanto看涨期权进行对冲：买入$\delta$份标的资产，买入资产所需成本超过期权价值的部分通过借入资金融资。
不过，对于quanto看涨期权，标的资产应该理解为前面两节所描述的价值为V的一个投资组合，该投资组合将V(0)单位的本国货币投资于外国资产，同时以外国无风险利率借入同等数量的资金，并将V(0)单位的本国货币投资于本国无风险资产。
看涨期权的$\delta$为$N(d_1)$，因此对冲组合将$N(d_1)V(0)$单位的本国货币投资于外国资产，以外国无风险利率借入同等数量的资金，并将$N(d_1)V(0)$投资于本国无风险资产。投资组合所需成本和期权价值的差额为
$$
N(d_1)V(0)-[V(0)N(d_1)-e^{-rT}KN(d_2)]=e^{-rT}KN(d_2)
$$
这个差额通过以蹦过无风险利率金融资金来融资。因此，本国无风险资产的净投资为
$$
N(d_1)V(0)-e^{-rT}KN(d_2)
$$
恰好等于期权的价值。由此得出

  为了对卖出quanto看涨期权进行德尔塔对冲，需要将$N(d_1)V(0)$单位的本国货币投资于外国资产，以外国无风险利率借入同等数量的资金，并将期权价值投资于本国无风险资产。

  以外国无风险利率借入$N(d_1)V(0)$单位的本国货币可以用以本国无风险利率借入同等数量的资金同时卖出$e^{r_f T}N(d_1)V(0)/X(0)$的货币远期代替。由此得出

  对卖出quanto看涨期权进行德尔塔对冲的一种等价方法，是将$N(d_1)V(0)$单位的本国货币投资于外国资产，以市场价格F(0)卖出$e^{r_f T}N(d_1)V(0)/X(0)$的货币远期合约，同时以本国无风险利率借入$e^{-rT}KN(d_2)$的资金。

## 收益互换
  用$S_f$和$S_d$分别表示外国资产的价格和本国资产的价格，并假设它们的红利支付率为常数，分别为$q_f$和$q_d$。如果收益的计算中不包含红利，则投资者得到的收入为
$$
\left( \frac{S_f(T) - S_f(0)}{S_f(0)} - \frac{S_d(T) - S_d(0)}{S_d(0)} \right) A = \left( \frac{S_f(T)}{S_f(0)} - \frac{S_d(T)}{S_d(0)} \right) A
$$
其中A表示名义本金。
	互换在0时的市场价值可以不等于0,这意味着必须进行提前支付。为了消除这一点，可以在互换合约中增加一个“互换价差”，增加的互换价差会影响到T时的回报函数。
	互换价差为某个常数a（可正可负），将其包含在合约后，投资者得到的收入改为
$$
	 \left( a+\frac{S_f(T)}{S_f(0)} - \frac{S_d(T)}{S_d(0)} \right) A \tag{6.18}
$$
需要解决的问题是：“合适”的互换价差是多少？即a取什么值才能让（6.18）中的现金流在0时的市场价值为0？
为方便起见取A=1。现金流由三部分组成，三部分现金流的收入或者支出都在T时发生：
+ 常数a
  T时a单位的蹦过货币在0时的价值为$e^{-rT}a$
+ 本国资产毛收益
	在T时价值为$S_d(T)$的本国资产在时刻0的价值为$e^{-q_dT}S_d(0)$
	故$\frac{S_f(T)}{S_f(0)}=e^{-q_dT}$
+ 外国资产毛收益
  可以把$1/S_f(0)$作为quanto定义中的固定利率$\bar{X}$。同前面一样，需要假设外国资产价格$S_f$和汇率它们的波动率为常数，它们的相关系数也是常数，从（6.6）得出，在T时得到$\bar{X}S_f(T)=S_f(T)/S_f(0)$单位的本国货币在0时的价值为
$$
\exp\{(r_f-r-q_f-\rho\sigma_x\sigma_s)T\}
$$

将各部分相加，得出现金流（6.18）（A=1）在0时的价值为
$$
e^{-rT}a+\exp\{(r_f-r-q_f-\rho\sigma_x\sigma_s)T\}-e^{-q_dT}
$$
由此得出以下结论：
为使T时现金流（6.18）在0时的价值等于0,合适的互换价差是
$$
a=\exp\{(r-q_d)T\}-\exp\{(r_f-q_f-\rho\sigma_x\sigma_s)T\} \tag{6.19}
$$

## 风险中性概率下的无抛补利率平价
将汇率看成红利支付率为外国无风险利率的资产的本国价格， 采用（2.27）可得出
$$
\frac{dX}{X}=(r-r_f)dt+\sigma_x dB^*_x
\tag{6.20}
$$
其中$B_x^*$时风险中性概率测度下的布朗运动
这个等式可以进行很有意义的解释，即==“无抛补利率平价”== 。无抛物利率平价理论认为，从总体上看，不同币种的利率差将被货币的升值或者贬值所抵消，换句话说，借入低利率货币而投资于高利率货币的策略是不能赚钱的，因为高利率货币相对于低利率货币将会贬值。众所周知，这个理论在实际中并非总是成立。不过，等式（6.20）说明，当采用风险中性概率计算数学期望时，无抛物利率平价关系成立。

假设外国利率$r_f$低于本国利率r，则投资者会以外国利率借入资金以本国利率投资，由此产生一个外币空头头寸。等式（6.20）告诉我们，人们（在风险中心概率测度下）预期汇率将以$r-r_f$的速度升值，因此用本币来进行再支付的成本将升高，由此抵消利率差。