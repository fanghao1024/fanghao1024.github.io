---
layout: post
title: "rustå¸¸ç”¨åº“å‡½æ•°åŠæ–¹æ³•å°æ‘˜"
description: "è®°å½•æ—¥å¸¸å·¥ä½œå­¦ä¹ ä¸­ç¢°åˆ°è¿‡çš„rustçš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼Œæ–¹ä¾¿æŸ¥é˜…"
author:   "Hao"
category: true
tagline: "rust changes the world"
tags: [programming ,algorithm,rust]
---
[toc]

# ç»Ÿè®¡ç›¸å…³

## éšæœºæ•°ç”Ÿæˆ

rand 0.9.x è¦è®¾ç½®ç§å­ä¸”ç”Ÿæˆéšæœºæ•°

åœ¨ `rand` 0.9.x ç‰ˆæœ¬ä¸­ï¼ŒAPI å˜å¾—æ›´åŠ è¯­ä¹‰åŒ–ã€‚è¦å®ç°â€œè®¾ç½®ç§å­â€å¹¶â€œç”Ÿæˆéšæœºæ•°â€ï¼Œæœ€æ ‡å‡†ä¸”å®Œæ•´çš„ä»£ç å¦‚ä¸‹ã€‚

1. é…ç½®æ–‡ä»¶ (`Cargo.toml`)

ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯ 0.9 ç‰ˆæœ¬ã€‚å¦‚æœä½ éœ€è¦ç”Ÿæˆå¸ƒæœ—è¿åŠ¨å¸¸ç”¨çš„æ­£æ€åˆ†å¸ƒï¼Œå»ºè®®åŠ ä¸Š `rand_distr`ã€‚

```toml
[dependencies]
rand = "0.9"
rand_distr = "0.5" # ç”¨äºæ­£æ€åˆ†å¸ƒç­‰å¤æ‚åˆ†å¸ƒ
```

2. å®Œæ•´å®ç°ä»£ç 

è¿™æ˜¯åœ¨ 0.9.x ä¸­ä½¿ç”¨ `StdRng` è®¾ç½®ç§å­å¹¶ç”Ÿæˆéšæœºæ•°çš„æ ‡å‡†èŒƒä¾‹ï¼š

Rust

```rust
use rand::{Rng, SeedableRng}; // å¿…é¡»å¯¼å…¥è¿™ä¸¤ä¸ª Trait
use rand::rngs::StdRng;
use rand_distr::{Normal, Distribution};

fn main() {
    // --- 1. è®¾ç½®ç§å­ ---
    // æ–¹å¼ A: ä½¿ç”¨ç®€å•çš„ u64 æ•°å­—ä½œä¸ºç§å­ (æœ€å¸¸ç”¨)
    let mut rng = StdRng::seed_from_u64(42);

    // æ–¹å¼ B: ä½¿ç”¨ 32 å­—èŠ‚æ•°ç»„ (æ›´åº•å±‚/ç²¾ç¡®)
    // let seed: [u8; 32] = [0u8; 32];
    // let mut rng = StdRng::from_seed(seed);

    // --- 2. ç”Ÿæˆéšæœºæ•° ---
    
    // ç”ŸæˆåŸºç¡€éšæœºæ•° (0.9 ç‰ˆæœ¬æ¨èä½¿ç”¨ .random() ä»£æ›¿ .gen())
    let n1: f64 = rng.random(); 
    println!("0.0 åˆ° 1.0 ä¹‹é—´çš„éšæœºæ•°: {}", n1);

    // ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°
    let n2: i32 = rng.random_range(1..=100);
    println!("1 åˆ° 100 ä¹‹é—´çš„æ•´æ•°: {}", n2);

    // --- 3. ç»“åˆå¸ƒæœ—è¿åŠ¨åœºæ™¯ (æ­£æ€åˆ†å¸ƒ) ---
    // ç”Ÿæˆå‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒéšæœºæ•°
    let normal = Normal::new(0.0, 1.0).unwrap();
    let v: f64 = normal.sample(&mut rng);
    println!("æ­£æ€åˆ†å¸ƒéšæœºæ•° (ç”¨äºå¸ƒæœ—è¿åŠ¨æ­¥é•¿): {}", v);
}
```

3. `rand` 0.9.x çš„å…³é”®å˜åŒ–æ€»ç»“

ä¸ºäº†æ–¹ä¾¿ä½ è®°å¿†ï¼Œè¿™é‡Œå¯¹æ¯”äº†æ–°æ—§ç‰ˆæœ¬çš„æ ¸å¿ƒå·®å¼‚ï¼š

| **åŠŸèƒ½**               | **0.8.x åŠæ—§ç‰ˆæœ¬**       | **0.9.x æ–°ç‰ˆæœ¬**          |
| ---------------------- | ------------------------ | ------------------------- |
| **åŸºç¡€ç”Ÿæˆæ–¹æ³•**       | `rng.gen::<f64>()`       | `rng.random::<f64>()`     |
| **èŒƒå›´ç”Ÿæˆæ–¹æ³•**       | `rng.gen_range(1..10)`   | `rng.random_range(1..10)` |
| **ä»ç³»ç»Ÿè·å–éšæœºç§å­** | `StdRng::from_entropy()` | `StdRng::from_os_rng()`   |
| **è·å–çº¿ç¨‹å±€éƒ¨ç”Ÿæˆå™¨** | `rand::thread_rng()`     | `rand::rng()`             |
| **ç§å­ Trait**         | `SeedableRng`            | `SeedableRng` (ä¿æŒä¸å˜)  |

4. ä¸ºä»€ä¹ˆåœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ `StdRng`ï¼Ÿ

åœ¨ä½ çš„å¸ƒæœ—è¿åŠ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ `StdRng` æ˜¯æ­£ç¡®çš„é€‰æ‹©ï¼ŒåŸå› æœ‰äºŒï¼š

1. **ç¡®å®šæ€§**ï¼šç»™å®šç›¸åŒçš„ç§å­ï¼Œ`StdRng` åœ¨æ‰€æœ‰å¹³å°ä¸Šäº§ç”Ÿçš„éšæœºåºåˆ—æ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹é‡‘èå»ºæ¨¡å’Œç§‘å­¦è®¡ç®—çš„â€œå¯å¤ç°æ€§â€è‡³å…³é‡è¦ã€‚
2. **æ€§èƒ½ä¸è´¨é‡**ï¼šå®ƒæ¯” `SmallRng` æ›´å®‰å…¨ï¼Œæ¯”ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ›´å¿«ã€‚

------



## äºŒå…ƒæ ‡å‡†æ­£æ€ç´¯ç§¯åˆ†å¸ƒå‡½æ•°

è®¡ç®—ç›¸å…³ç³»æ•°ä¸º $\rho$ çš„ä¸¤ä¸ª**æ ‡å‡†æ­£æ€éšæœºå˜é‡** $\xi_1$ å’Œ $\xi_2$ åŒæ—¶æ»¡è¶³ $\xi_1 < a$ ä¸” $\xi_2 < b$ çš„æ¦‚ç‡ $P(\xi_1 < a, \xi_2 < b)$

`owens-t` crate æä¾›äº† **Owen's T å‡½æ•°**çš„å®ç°ï¼Œè¯¥å‡½æ•°å¯ä»¥ç”¨æ¥è®¡ç®—äºŒå…ƒæ ‡å‡†æ­£æ€ CDFã€‚

```toml
[dependencies]
owens-t = "0.1" # æ£€æŸ¥ crates.io è·å–æœ€æ–°ç‰ˆæœ¬
```

`owens-t` crate ä¸­çš„ `biv_norm` å‡½æ•°å¯ä»¥è®¡ç®— $P(X > x, Y > y)$ã€‚

$$\text{biv\_norm}(x, y, \rho) = P(\xi_1 > x, \xi_2 > y)$$

ç”±äº $\xi_1$ å’Œ $\xi_2$ æ˜¯å…³äºåŸç‚¹å¯¹ç§°çš„ï¼Œå¹¶ä¸” $P(\xi_1 < a, \xi_2 < b)$ æ˜¯ç´¯ç§¯åˆ†å¸ƒå‡½æ•° (CDF)ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ä»¥ä¸‹å…³ç³»å°†æ‚¨æ‰€éœ€çš„ $P(\xi_1 < a, \xi_2 < b)$ è½¬æ¢ä¸ºç”± `biv_norm` è®¡ç®—çš„æ¦‚ç‡ï¼š

1. **ä¸€å…ƒæ ‡å‡†æ­£æ€ CDFï¼š** $\Phi(x) = P(\xi < x)$ã€‚

   - $P(\xi > x) = 1 - \Phi(x)$

2. **åŒ…å«å…³ç³»ï¼š** $P(\xi_1 < a, \xi_2 < b) = 1 - P(\xi_1 > a) - P(\xi_2 > b) + P(\xi_1 > a, \xi_2 > b)$

   - æ³¨æ„åˆ° $P(\xi_1 > a)$ å’Œ $P(\xi_2 > b)$ å¯ä»¥é€šè¿‡ä¸€å…ƒæ ‡å‡†æ­£æ€ CDF è®¡ç®—ï¼š

     $$P(\xi_1 > a) = 1 - \Phi(a)$$

     $$P(\xi_2 > b) = 1 - \Phi(b)$$

   - $P(\xi_1 > a, \xi_2 > b)$ åˆ™é€šè¿‡ biv_norm è®¡ç®—ï¼š

     $$P(\xi_1 > a, \xi_2 > b) = \text{biv\_norm}(a, b, \rho)$$

å› æ­¤ï¼Œæ‚¨æ‰€éœ€çš„æ¦‚ç‡ä¸ºï¼š

$$P(\xi_1 < a, \xi_2 < b) = 1 - (1 - \Phi(a)) - (1 - \Phi(b)) + \text{biv\_norm}(a, b, \rho)$$

$$\mathbf{P(\xi_1 < a, \xi_2 < b) = \Phi(a) + \Phi(b) - 1 + \text{biv\_norm}(a, b, \rho)}$$

æ‚¨è¿˜éœ€è¦ä¸€ä¸ªè®¡ç®—ä¸€å…ƒæ ‡å‡†æ­£æ€ CDF $\Phi(x)$ çš„å‡½æ•°ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨ `statrs` crate ä¸­çš„ `Normal::standard().cdf(x)`ã€‚

```rust
use owens_t;
// è¿˜éœ€è¦ä¸€ä¸ªç”¨äºæ ‡å‡†æ­£æ€ CDF (Phi(x)) çš„åº“ï¼Œä¾‹å¦‚ statrs
// Cargo.toml ä¸­éœ€è¦æ·»åŠ  statrs = "0.18" (æˆ–å…¶ä»–ç‰ˆæœ¬)
use statrs::distribution::{ContinuousCDF, Normal};

/// è®¡ç®— P(xi_1 < a, xi_2 < b)
fn bivariate_standard_normal_cdf_via_owens(a: f64, b: f64, rho: f64) -> f64 {
    // 1. è·å–æ ‡å‡†æ­£æ€ CDF å‡½æ•°
    let standard_normal = Normal::new(0.0, 1.0).unwrap();
    let phi_a = standard_normal.cdf(a);
    let phi_b = standard_normal.cdf(b);

    // 2. ä½¿ç”¨ owens_t::biv_norm è®¡ç®— P(xi_1 > a, xi_2 > b)
    // biv_norm(a, b, rho) è®¡ç®— P(X > a, Y > b)
    let p_gt_a_gt_b = owens_t::biv_norm(a, b, rho);

    // 3. åº”ç”¨æ¦‚ç‡æ’ç­‰å¼: P(A, B) = 1 - P(A^c) - P(B^c) + P(A^c, B^c)
    // P(xi_1 < a, xi_2 < b) = 1 - P(xi_1 > a) - P(xi_2 > b) + P(xi_1 > a, xi_2 > b)
    // P(xi_1 < a, xi_2 < b) = phi_a + phi_b - 1 + p_gt_a_gt_b
    
    // æ³¨æ„: biv_norm çš„å‚æ•°æ˜¯ f64ï¼Œç›´æ¥ä¼ é€’ a, b å³å¯
    phi_a + phi_b - 1.0 + p_gt_a_gt_b
}

fn main() {
    let a = 1.0;
    let b = 1.0;
    let rho = 0.5;

    let probability = bivariate_standard_normal_cdf_via_owens(a, b, rho);

    println!("a = {}, b = {}, rho = {}", a, b, rho);
    println!("P(xi_1 < a, xi_2 < b) = {}", probability);
}
```



# äºŒåˆ†æŸ¥æ‰¾

`partition_point`æ–¹æ³•æ˜¯å®ç° `lower_bound`å’Œ `upper_bound`åŠŸèƒ½æœ€ç›´æ¥å’Œæ¨èçš„æ–¹å¼ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªè°“è¯ï¼ˆè¿”å› `bool`çš„é—­åŒ…ï¼‰ï¼Œå¹¶è¿”å›åˆ‡ç‰‡ä¸­**ç¬¬ä¸€ä¸ªä½¿è¯¥è°“è¯è¿”å› `false`**çš„å…ƒç´ çš„ç´¢å¼•

## ç±»ä¼¼C++çš„lower_bound

æŸ¥æ‰¾ç¬¬ä¸€ä¸ª**å¤§äºç­‰äº**ç›®æ ‡å€¼çš„å…ƒç´ ä½ç½®ã€‚

è°“è¯æ¡ä»¶æ˜¯åˆ¤æ–­å…ƒç´ æ˜¯å¦**å°äº**ç›®æ ‡å€¼ã€‚è¿”å›çš„ä½ç½®å°±æ˜¯ç¬¬ä¸€ä¸ªâ€œä¸å°äºâ€ï¼ˆå³å¤§äºç­‰äºï¼‰ç›®æ ‡å€¼çš„ä½ç½®

```rust
let nums = vec![1, 2, 3, 3, 4];
let target = 3;

// æŸ¥æ‰¾ç¬¬ä¸€ä¸ª >= target çš„å…ƒç´ çš„ä½ç½® (lower_bound)
let lower = nums.partition_point(|&x| x < target);
println!("Lower bound of {} is at index: {}", target, lower); // è¾“å‡º 2
```

## ç±»ä¼¼C++çš„upper_bound

```rust
// æŸ¥æ‰¾ç¬¬ä¸€ä¸ª > target çš„å…ƒç´ çš„ä½ç½® (upper_bound)
let upper = nums.partition_point(|&x| x <= target);
println!("Upper bound of {} is at index: {}", target, upper); // è¾“å‡º 4
```

## æ’å…¥æ“ä½œ

```rust
let j = g.partition_point(|&x| x < h);
if j < g.len() {
    g[j] = h;
} else {
    g.push(h);
}
```

# sort_byæŒ‰æ¡ä»¶æ’åº

`sort_by(|a, b| ...)`ä¸­çš„é—­åŒ…ï¼Œå…¶æ ¸å¿ƒä»»åŠ¡æ˜¯å›ç­”ä¸€ä¸ªé—®é¢˜ï¼š**ç›¸å¯¹äº `a`ï¼Œ`b`çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ**æˆ–è€…æ›´ç›´ç™½åœ°è¯´ï¼š**åœ¨æœ€ç»ˆçš„æ’åºç»“æœä¸­ï¼Œ`b`åº”è¯¥å‡ºç°åœ¨ `a`çš„å‰é¢è¿˜æ˜¯åé¢ï¼Ÿ**

- å½“é—­åŒ…è¿”å› `Ordering::Less`æ—¶ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆaï¼‰åº”è¯¥æ’åœ¨ç¬¬äºŒä¸ªå‚æ•°(b)**ä¹‹å‰**ã€‚
- åœ¨ `a.cmp(b)`ä¸­ï¼Œå¦‚æœ `a`å°äº `b`ï¼Œåˆ™è¿”å› `Less`ï¼Œæ‰€ä»¥ `a`ä¼šæ’åœ¨ `b`å‰é¢ï¼Œå½¢æˆé€’å¢ã€‚
- åœ¨ `b.cmp(a)`ä¸­ï¼Œå¦‚æœ `b`å°äº `a`ï¼Œåˆ™è¿”å› `Less`ï¼Œæ‰€ä»¥ `a`ä¼šæ’åœ¨ `b`å‰é¢ï¼Œè¿™ç›¸å½“äºæŠŠå¤§çš„æ•°å¾€å‰æ”¾ï¼Œå½¢æˆé€’å‡ã€‚

æ‰€ä»¥ï¼Œæ•´ä¸ªä»£ç  `tasks.sort_by(|a, b| b.cmp(a))`çš„å·¥ä½œæµç¨‹æ˜¯ï¼š

1. æ’åºç®—æ³•æ¯æ¬¡å–å‡ºé›†åˆä¸­çš„ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ä½œä¸ºé—­åŒ…çš„å‚æ•° `a`å’Œ `b`ã€‚
2. é—­åŒ…æ‰§è¡Œ `b.cmp(a)`ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ **`b`ç›¸å¯¹äº `a`çš„é¡ºåº**ã€‚
3. å¦‚æœ `b`æ¯” `a`å¤§ï¼ˆå³ `b.cmp(a)`è¿”å› `Ordering::Greater`ï¼‰ï¼Œæ’åºç®—æ³•å°±ä¼šè®¤ä¸º `a`åº”è¯¥æ’åœ¨ `b`çš„åé¢ï¼Œä»è€Œå®ç°äº†**ä»å¤§åˆ°å°**çš„é™åºæ’åˆ—ã€‚

```rust
let mut v = [5, 4, 1, 3, 2];
// é™åºæ’åº
v.sort_by(|a, b| b.cmp(a));
assert!(v == [5, 4, 3, 2, 1]); // ç»“æœæ˜¯ä»å¤§åˆ°å°
```

## ä¸€ç§é”™è¯¯ä½¿ç”¨

```rust
pub fn erase_overlap_intervals(intervals: Vec<Vec<i32>>) -> i32 {
        let n=intervals.len();
        let mut intervals=intervals;
        intervals.sort_by(|&a,&b|a[1].cmp(&b[1])); //è¿™é‡Œåº”è¯¥æ”¹ä¸º|a,b|
        let mut rec=1;
        let mut preed=intervals[0][1];
        for i in 1..n{
            if intervals[i][0]>=preed{
                rec+=1;
                preed=intervals[i][1];
            }
        }
        (n-rec) as i32
    }
```

è¯´æ˜ï¼š

1. **é—­åŒ…å‚æ•°çš„æ¨¡å¼åŒ¹é…é—®é¢˜**ï¼š

- **é—­åŒ…è·å¾—çš„æ˜¯å¼•ç”¨**ï¼šå½“ä½ çš„é—­åŒ…è¢« `sort_by`è¿™æ ·çš„é«˜é˜¶å‡½æ•°è°ƒç”¨æ—¶ï¼Œè¯¥é«˜é˜¶å‡½æ•°ä¼ é€’ç»™é—­åŒ…çš„æ˜¯é›†åˆä¸­å…ƒç´ çš„**å¼•ç”¨**ï¼ˆåœ¨ä½ çš„ä»£ç ä¸­å°±æ˜¯ `&Vec<i32>`ï¼‰ã€‚æ‰€ä»¥ï¼Œæ— è®ºä½ å¦‚ä½•å†™é—­åŒ…çš„å‚æ•°åˆ—è¡¨ï¼Œé—­åŒ…å®é™…æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚ä½¿ç”¨ `|a, b|`æ—¶ï¼Œ`a`å’Œ `b`ç›´æ¥å°±æ˜¯è¿™ä¸¤ä¸ªå¼•ç”¨ `&Vec<i32>`ã€‚ä½¿ç”¨ `|&a, &b|`æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…ï¼Œä½ æ˜¯åœ¨å‘Šè¯‰ Rustï¼š"æˆ‘æœŸæœ›æ¥æ”¶åˆ°çš„å‚æ•°æ˜¯å¼•ç”¨ï¼Œå¹¶ä¸”è¯·è‡ªåŠ¨è§£æ„è¿™ä¸ªå¼•ç”¨ï¼Œå°†å…¶å†…éƒ¨çš„å€¼ç»‘å®šåˆ°å˜é‡ `a`å’Œ `b`ä¸Š"ã€‚
- **é—®é¢˜çš„æ ¹æºï¼šç§»åŠ¨é Copy ç±»å‹**ï¼šè§£æ„ä¸€ä¸ªå¼•ç”¨ï¼ˆ`&Vec<i32>`ï¼‰å¹¶è¯•å›¾å°†å…¶å†…éƒ¨çš„å€¼ï¼ˆ`Vec<i32>`ï¼‰ç»‘å®šåˆ°æ–°å˜é‡ï¼ˆ`a`, `b`ï¼‰ä¸Šï¼Œæ„å‘³ç€ä½ éœ€è¦å°† `Vec<i32>`ä»å¼•ç”¨èƒŒå**ç§»åŠ¨**å‡ºæ¥ã€‚ä½†æ˜¯ï¼ŒRust ä¸å…è®¸ä½ é€šè¿‡ä¸€ä¸ªå…±äº«å¼•ç”¨ï¼ˆ`&T`ï¼‰æ¥ç§»åŠ¨å…¶æŒ‡å‘çš„æ•°æ®ï¼Œå› ä¸ºä½ å¹¶ä¸æ‹¥æœ‰è¯¥æ•°æ®çš„æ‰€æœ‰æƒã€‚è¿™å°±æ˜¯ç¼–è¯‘å™¨æŠ¥é”™ "cannot move out of a shared reference" çš„åŸå› ã€‚åªæœ‰å½“ç±»å‹å®ç°äº† `Copy`traitï¼ˆä¾‹å¦‚ç®€å•çš„æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰ï¼ŒRust æ‰ä¼šåœ¨è§£æ„æ—¶è‡ªåŠ¨è¿›è¡Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œè¿™æ ·æ“ä½œæ‰æ˜¯å®‰å…¨çš„ã€‚è€Œ `Vec<i32>`æ²¡æœ‰å®ç° `Copy`trait ã€‚

2. **å¯¹æ¯”ç®€å•ç±»å‹**ï¼š

   å¦‚æœç±»å‹å®ç°äº† `Copy`ï¼ˆå¦‚ `i32`ï¼‰ï¼Œæ¨¡å¼åŒ¹é… `|&a, &b|`æ˜¯å…è®¸çš„ï¼Œå› ä¸ºè§£æ„æ—¶ä¼šå¤åˆ¶å€¼è€Œéç§»åŠ¨ã€‚ä½† `Vec<i32>`ä¸æ”¯æŒå¤åˆ¶ï¼Œåªèƒ½ç§»åŠ¨ï¼Œä»è€Œè§¦å‘æ‰€æœ‰æƒè§„åˆ™æ£€æŸ¥ã€‚
3. ä¸ºä»€ä¹ˆä¿®æ”¹ä¸º|a,b|æœ‰æ•ˆ

   - `sort_by`æ–¹æ³•ä¼šå‘é—­åŒ…ä¼ é€’**å…ƒç´ çš„å¼•ç”¨**ï¼ˆå³ `&Vec<i32>`ï¼‰ã€‚
   - ç›´æ¥ä½¿ç”¨ `|a, b|`åï¼Œ`a`å’Œ `b`ä¿æŒä¸ºå¼•ç”¨ç±»å‹ï¼Œé€šè¿‡ `a[1]`å’Œ `b[1]`è®¿é—®å…ƒç´ æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨è§£å¼•ç”¨ï¼ˆDeref coercionï¼‰ï¼Œè€Œä¸ä¼šè§¦å‘æ‰€æœ‰æƒç§»åŠ¨ã€‚
   - ç”±äºä¸æ¶‰åŠç§»åŠ¨ï¼Œç¼–è¯‘å™¨ä¸å†æŠ¥é”™
4. cmpå‡½æ•°é‡Œä¸ºä»€ä¹ˆåˆåŠ äº†å¼•ç”¨.cmp(&b[1])

   `cmp`æ–¹æ³•ï¼ˆå±äº `i32`ç±»å‹ï¼‰çš„å®šä¹‰æ˜¯ `fn cmp(&self, other: &Self) -> Ordering`ã€‚å®ƒéœ€è¦çš„æ˜¯å¯¹ä¸¤ä¸ªè¦æ¯”è¾ƒçš„å€¼çš„**å¼•ç”¨**ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ `&`æ¥è·å– `b[1]`è¿™ä¸ª `i32`å€¼çš„å¼•ç”¨ã€‚

å®¹æ˜“æ··æ·†çš„åœ°æ–¹ï¼š

å¯¹äºä¸€ä¸ªå¼•ç”¨ç±»å‹b(æ¯”å¦‚bæ˜¯&Vec `<i32>`)ï¼Œ`b`å’Œ `b[1]`ç¡®å®æ˜¯ä¸¤ç§ä¸åŒçš„ä¸œè¥¿ã€‚

ç®€å•æ¥è¯´ï¼š**`b`æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆæŒ‡å‘æ•´ä¸ª `Vec`ï¼‰ï¼Œè€Œ `b[1]`æ˜¯é€šè¿‡ç´¢å¼•æ“ä½œä» `b`æ‰€æŒ‡å‘çš„å‘é‡ä¸­å–å‡ºçš„ä¸€ä¸ªå…·ä½“çš„å€¼ï¼ˆ`i32`ï¼‰**ã€‚

ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°å±•ç¤ºäº†ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ï¼š

|            ç‰¹æ€§            | `b`ï¼ˆé—­åŒ…å‚æ•°ï¼‰                    | `b[1]`ï¼ˆç´¢å¼•æ“ä½œç»“æœï¼‰                                      |
| :------------------------: | ------------------------------------ | ------------------------------------------------------------- |
|     **å®é™…ç±»å‹**     | `&Vec<i32>`ï¼ˆå¼•ç”¨ï¼‰                | `i32`ï¼ˆå€¼ï¼‰                                                 |
|       **æœ¬è´¨**       | ä¸€ä¸ªâ€œæŒ‡é’ˆâ€ï¼ŒæŒ‡å‘å‘é‡æ•°æ®çš„å†…å­˜åœ°å€ | å‘é‡ä¸­å­˜å‚¨çš„å…·ä½“çš„æ•´æ•°å€¼                                      |
|      **æ‰€æœ‰æƒ**      | ä¸æ‹¥æœ‰æ•°æ®çš„æ‰€æœ‰æƒï¼ˆå€Ÿç”¨ï¼‰           | å¯¹äº `i32`è¿™ç§å®ç°äº† `Copy`çš„ç±»å‹ï¼Œä½ ä¼šå¾—åˆ°è¯¥å€¼çš„ä¸€ä¸ªå‰¯æœ¬ |
| **å¦‚ä½•ç”¨äº `cmp`** | é€šè¿‡ `b[1]`è®¿é—®å…¶å…ƒç´               | éœ€è¦å–å…¶å¼•ç”¨ `&b[1]`ä»¥åŒ¹é… `cmp`ç­¾å                      |

| åœºæ™¯                          | å‘é‡ç±»å‹ (`intervals`) | é—­åŒ…å‚æ•° (`a`, `b`) ç±»å‹ | ç´¢å¼•æ“ä½œ (`a[1]`) ç»“æœç±»å‹ | æ¨èçš„æ¯”è¾ƒå†™æ³•      |
| :---------------------------- | :----------------------- | :--------------------------- | :--------------------------- | :------------------ |
| **å…ƒç´ ä¸º `i32`**      | `Vec<Vec<i32>>`        | `&Vec<i32>`                | `i32`(å€¼)                  | `a[1].cmp(&b[1])` |
| **å…ƒç´ ä¸º `Vec<i32>`** | `Vec<Vec<Vec<i32>>>`   | `&Vec<Vec<i32>>`           | `&Vec<i32>`(å¼•ç”¨)          | `a[1].cmp(b[1])`  |

# ç»“æ„ä½“æ’åº

```rust
//envelopes: mut Vec<Vec<i32>>
envelopes.sort_unstable_by_key(|e| (e[0], -e[1]));
```

# æœ€å°å †çš„å®ç°

rustçš„BinaryHeapé»˜è®¤å®ç°æœ€å¤§å †ï¼Œå¦‚æœè¦å»ºç«‹æœ€å°å †ï¼Œå¯ä»¥ä½¿ç”¨ Reverse åŒ…è£…å™¨ï¼Œstd::cmp::Reverse æ˜¯ä¸€ä¸ªç®€å•çš„åŒ…è£…å™¨ç»“æ„ä½“ï¼Œå®ƒä¼šåè½¬å…¶å†…éƒ¨å€¼çš„æ’åºé¡ºåºã€‚

## åŸç†

å½“ä½ å°†ä¸€ä¸ªå…ƒç´  T åŒ…è£…åœ¨ Reverse `<T>` ä¸­æ—¶ï¼ŒReverse `<T>` çš„ Ord å®ç°ä¼šè°ƒç”¨ T çš„ Ord å®ç°ï¼Œä½†ä¼šè¿”å›ç›¸åçš„ç»“æœã€‚
a.cmp(b) è¿”å› Ordering::Lessï¼Œé‚£ä¹ˆ Reverse(a).cmp(&Reverse(b)) å°±ä¼šè¿”å› Ordering::Greaterã€‚
è¿™æ ·ä¸€æ¥ï¼ŒBinaryHeap åœ¨æ¯”è¾ƒ Reverse å…ƒç´ æ—¶ï¼Œå°±ä¼šæŠŠæœ€å°çš„åŸå§‹å…ƒç´ å½“æˆ â€œæœ€å¤§â€ çš„ Reverse å…ƒç´ ï¼Œä»è€Œå°†å…¶æ”¾åœ¨å †é¡¶ã€‚

## å®ç°

```rust

use std::collections::BinaryHeap;
use std::cmp::Reverse;

fn main() {
    // åˆ›å»ºä¸€ä¸ªå­˜å‚¨ Reverse<i32> çš„ BinaryHeap
    let mut min_heap = BinaryHeap::new();

    // æ’å…¥å…ƒç´ æ—¶ï¼Œç”¨ Reverse åŒ…è£…èµ·æ¥
    min_heap.push(Reverse(3));
    min_heap.push(Reverse(1));
    min_heap.push(Reverse(2));

    println!("æœ€å°å †å¼¹å‡ºé¡ºåºï¼š");
    while let Some(Reverse(num)) = min_heap.pop() {
        println!("{}", num); // è¾“å‡ºé¡ºåºï¼š1, 2, 3
    }
}

```

```rust
//ç”¨æœ€å°å †å®ç°éœå¤«æ›¼æ ‘
use std::collections::BinaryHeap;
use std::cmp::Reverse;
impl Solution {
    pub fn min_build_time(blocks: Vec<i32>, split: i32) -> i32 {
        let n=blocks.len();
        let mut pqu=BinaryHeap::new();
        for i in 0..n{
            pqu.push(Reverse(blocks[i]));
        }
        while pqu.len()>1{
            let a=pqu.pop().unwrap().0;
            let b=pqu.pop().unwrap().0;
            pqu.push(Reverse(split+std::cmp::max(a,b)));
        }
        pqu.pop().unwrap().0
    }
}

```

# é—­åŒ…

+ Fné—­åŒ…
  é€šè¿‡==å¼•ç”¨==æ•è·å˜é‡ï¼Œä¸å¯å˜å€Ÿç”¨ã€‚
+ FnMuté—­åŒ…
  é€šè¿‡==å¯å˜å¼•ç”¨==æ•è·å˜é‡ï¼Œå¯å˜å€Ÿç”¨ã€‚
+ FnOnceé—­åŒ…
  é€šè¿‡==å€¼==æ•è·å˜é‡ï¼Œæ‰€æœ‰æƒè½¬ç§»ã€‚

```rust
fn main(){
    let x=5;
    let y=10;

    //Fné—­åŒ…ï¼šé€šè¿‡å¼•ç”¨æ•è·å˜é‡
    let add = |a| a+x;

    //FnMuté—­åŒ…ï¼šé€šè¿‡å¯å˜å¼•ç”¨æ•è·å˜é‡
    let mut multiply = |a|{
        a/y
    };

    //FnOnceé—­åŒ…ï¼šé€šè¿‡å€¼æ•è·å˜é‡
    let divide = move |a|{
    a/y
    };
}

```

# å¤šçº¿ç¨‹

## spawnåˆ›å»ºçº¿ç¨‹

```rust
use std::{thread,time::Duration,Builder};

fn main(){
    thread::spawn(|| {
        for i in 1..10 {
            println!("hi number {} from the spawned thread!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    //Threadä¹Ÿæ”¯æŒé€šè¿‡std::thread::Builderç»“æ„ä½“è¿›è¡Œåˆ›å»ºï¼ŒBuilderæä¾›äº†ä¸€äº›çº¿ç¨‹çš„é…ç½®é¡¹

    let handle=Builder::new()
        .name("my_thread".to_string()) //çº¿ç¨‹å
        .stack_size(1024*4)    //è®¾ç½®çº¿ç¨‹çš„å †æ ˆå¤§å°æ˜¯1024*4
        .spawn({
            "hello world" //ç›¸å½“äºå­çº¿ç¨‹çš„æ‰§è¡Œç»“æœå°±æ˜¯å­—ç¬¦ä¸²"hello world"
        });
    let res=handle.join().unwrap();  //é˜»æ­¢å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ‰§è¡Œï¼Œç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå¾—åˆ°å­çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå³"hello world"

}


```

çº¿ç¨‹ä¸­ä½¿ç”¨äº†å…¶ä»–çº¿ç¨‹çš„å˜é‡æ˜¯ä¸åˆæ³•çš„ï¼Œå¿…é¡»ä½¿ç”¨moveè¡¨æ˜çº¿ç¨‹æ‹¥æœ‰dataçš„æ‰€æœ‰æƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨moveå…³é”®å­—æŠŠdataçš„æ‰€æœ‰æƒè½¬ç§»åˆ°å­çº¿ç¨‹å†…ã€‚

```rust
use std::thread;

fn main(){
    let data=String::from("hello world");
    let thread=std::thread::spawn(move ||{  //ä½¿ç”¨moveæŠŠdataçš„æ‰€æœ‰æƒè½¬åˆ°çº¿ç¨‹å†…
        println!("{}",data);
    });
    thread.join();

    let v=vec![1,3,5,7,9];
    let mut childs=vec![];
    for n in v{
        let c=thread::spawn(move ||{
            println!("{}",n*n);
        });
        childs.push(c);
    }
    for c in childs{
        c.join().unwrap();  //ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸï¼Œæˆ–è€…ä½¿ç”¨expectæ–¹æ³•æ¥è·å–è¿”å›å€¼
    }
}

```

moveé—­åŒ…é€šå¸¸å’Œthread::spawnå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨å…¶ä»–çº¿ç¨‹çš„æ•°æ®ï¼Œè¿™æ ·åœ¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼Œå¯ä»¥æŠŠå…¶ä»–çº¿ç¨‹ä¸­çš„å˜é‡çš„æ‰€æœ‰æƒä»ä¸€ä¸ªçº¿ç¨‹è½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨æ”¹å˜é‡äº†ã€‚

## å¾—åˆ°å½“å‰ç³»ç»Ÿçš„é»˜è®¤å¹¶è¡Œåº¦

```rust
use std::{io,thread};
fn main() ->io::Result<()>{
    let count=thread::available_parallelism()?.get();
    assert!(count>=1_usize);
    println!("{},{}",count,1_usize);
    Ok(())
}
```

## çº¿ç¨‹é—´é€šä¿¡

```rust

use std::sync::{Arc,Mutex};
use std::thread;

fn main() {
    let counter=Arc::new(Mutex::new(0));
    let mut handles=vec![];

    for _ in 0..10{
        let counter=Arc::clone(&counter);
        let handle=thread::spawn(move||{
            let mut num=counter.lock().unwrap();
            *num+=1;
        });
        handles.push(handle);
    }

    for handle in handles{
        handle.join().unwrap();
    }

    println!("result: {}",*counter.lock().unwrap());
}

```

# æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œå‘½ä»¤è¡Œå‚æ•°

std::ioæ¨¡å—

è¯¥æ¨¡å—æœ€æ ¸å¿ƒçš„éƒ¨åˆ†æ˜¯Readå’ŒWriteä¸¤ä¸ªtraitã€‚

trait Readç”¨äºè¯»ï¼›Writeç”¨äºå‘è¾“å‡ºæµä¸­å†™å…¥æ•°æ®ï¼ŒåŒ…å«å­—èŠ‚æ•°æ®å’ŒUTF-8æ•°æ®ä¸¤ç§æ ¼å¼ã€‚

## ä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–æ•°æ®

ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨trait Readï¼Œè€Œæ˜¯é€šè¿‡å®ç°å„ä¸ªå­traitæä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚

rustè¯­è¨€çš„Stdinå®è´¨ä¸Šæ˜¯"BufReader `<StdinRaw>`"çš„çº¿ç¨‹å®‰å…¨ç‰ˆã€‚

å‡½æ•°std::io::stdin()è¿”å›ä¸€ä¸ªstd::Stdinçš„å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä»£è¡¨æ ‡å‡†è¾“å…¥æµã€‚æ³¨æ„ï¼šå‡½æ•°stdin()ä¸­çš„sæ˜¯å°å†™çš„ï¼Œè€Œç»“æ„ä½“Stdinä¸­çš„S æ˜¯å¤§å†™çš„ã€‚

std::ioæ˜¯æ ‡å‡†åº“ä¸­å…³äºè¾“å…¥è¾“å‡ºçš„åŒ…ï¼Œæ ‡å‡†åº“æä¾›çš„std::io::stdin()ä¼šè¿”å›å½“å‰è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥æµstdinçš„å¥æŸ„ã€‚è€Œread_line()åˆ™æ˜¯æ ‡å‡†è¾“å…¥æµstdinçš„å¥æŸ„ä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä»æ ‡å‡†è¾“å…¥æµè¯»å–ä¸€è¡Œæ•°æ®ã€‚read_line()æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªResultæšä¸¾ï¼Œè€Œunwrap()åˆ™æ˜¯ç”¨äºç®€åŒ–å¯æ¢å¤é”™è¯¯çš„å¤„ç†ï¼Œå®ƒä¼šè¿”å›Resultä¸­å­˜å‚¨çš„å®é™…å€¼ã€‚

```rust
use std::io;

fn myf(){
    //ä¸€è¡Œæœ‰å¤šä¸ªæ•°
    let mut buf = String::new();
    io::stdin().read_line(&mut buf).unwrap();
    let mut nums=buf.split_whitespace();
    let num1:f64=nums.next().unwrap().parse().unwrap();
    let num2:f64=nums.next().unwrap().parse().unwrap();
    let num3:f64=nums.next().unwrap().parse().unwrap();
  
    //è¯»å…¥æ•°ç»„
    let mut buf=String::new();
    io::stdin().read_line(&mut buf).unwrap();
    let ns:Vec<i32>=buff.split_whitespace().map(|x| x.parse().unwrap()).collect();
    for v in ns{
        print!("{} ",v);
    }
}

fn main(){
    let mut buf=String::new();
    io::stdin().read_line(&mut buf).unwrap();
    let num1:i32=buf.trim().parse().unwrap();
    println!("{}",num1);
  
    myf();
}
```

å¦‚æœæœ‰å¤šä¸ªæ ‡å‡†è¾“å…¥æµå®ä¾‹ï¼Œåˆ™é€šè¿‡äº’æ–¥é”è¿›è¡ŒåŒæ­¥ã€‚

```rust
use std::io::{self,BufRead}
fn main()->io::Result<()>{
    let mut buffer=String::new();
    let mystdin=io::stdin();
    let mut handle=stdin.lock();  //æ˜¾å¼äº’æ–¥
  
    handle.read_line(&mut buffer);
    Ok(())
}


use std::io;
fn main()->io::Result<()>{
    let mut buffer=String::new();
    io::stdion().read_line(&mut buffer)ï¼› //éšå¼åŒæ­¥è¯»å–å†…å®¹
    Ok(())
}
```

ç›®å‰Rustæ ‡å‡†åº“è¿˜æ²¡æœ‰æä¾›ç›´æ¥ä»å‘½ä»¤è¡Œè¯»å–æ•°å­—æˆ–æ ¼å¼åŒ–æ•°æ®çš„æ–¹æ³•ã€‚

## æ ‡å‡†è¾“å‡ºæµ

std::io::stdout() ä¼šè¿”å› std::io::Stdoutç»“æ„ä½“ï¼Œè¡¨ç¤ºæ ‡å‡†è¾“å‡ºæµã€‚ç»“æ„ä½“Sdtoutå®ç°äº†Write traitã€‚å‡½æ•°stdoutæ˜¯æ¨¡å—std::ioçš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œä¸ºå½“å‰è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè¿”å›çš„æ˜¯å¥æŸ„Stdoutï¼Œè¿™ä¸ªå¥æŸ„å°±æ˜¯å½“å‰è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºæµçš„å¥æŸ„ã€‚stdoutå‡½æ•°è¿”å›çš„æ¯ä¸ªå¥æŸ„éƒ½æ˜¯å¯¹å…±äº«ç¼“å†²åŒºçš„å¼•ç”¨ï¼Œå› æ­¤å¯¹è¯¥ç¼“å†²åŒºçš„è®¿é—®é€šè¿‡äº’æ–¥é”è¿›è¡ŒåŒæ­¥ã€‚

éšå¼åŒæ­¥ï¼š

```rust
use std::io::{self,Write};

fn main()->io::Result<()>{
    io::stdout().write_all(b"hello world")?;
    Ok(())
}
```

æ˜¾å¼åŒæ­¥ï¼š

```rust
use std::io::{self,Write};

fn main()->io::Result<()>{
    let stdout=io::stdout();
    let mut handle=stdout.lock();
    handle.write_all(b"hello world")?;
    Ok(())
}
```

â€œæ ‡å‡†è¾“å‡ºâ€é€šå¸¸å°±æ˜¯æŒ‡ç»ˆç«¯å±å¹•ï¼Œè€Œâ€œæ ‡å‡†è¾“å…¥â€ä¸€èˆ¬å°±æ˜¯æŒ‡é”®ç›˜ã€‚

write()æ˜¯æ ‡å‡†è¾“å‡ºæµstdoutçš„å¥æŸ„ä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå‘æ ‡å‡†è¾“å‡ºæµå†™å…¥==å­—èŠ‚æµå†…å®¹==ã€‚

```rust
use std::io::Write;
fn main(){
    std::io::stdout().write("http".as_bytes()).unwrap();
}
```

## å‘½ä»¤è¡Œå‚æ•°

Rustè¯­è¨€åœ¨æ ‡å‡†åº“ä¸­å†…ç½®äº†std::env::args()å‡½æ•°è¿”å›æ‰€æœ‰çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå…¶ç¬¬ä¸€é¡¹æ˜¯ç¨‹åºåã€‚

```rust
fn main(){
    let cmd_line=std::env::args();
    for arg in cmd_line{
        println!("{} ",arg);
    }
}
```

<<<<<<< Updated upstream

# æ¨¡å—åŒ–

æ–‡ä»¶ç»“æ„ï¼š

```plaintext
AC/
â”œâ”€â”€ Calc/                # åº“ crateï¼ˆè¢«è°ƒç”¨æ–¹ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ lib.rs       # å« pub fn European_Call
â”‚   â””â”€â”€ Cargo.toml
â””â”€â”€ Chapter5/
    â””â”€â”€ C5/              # äºŒè¿›åˆ¶ crateï¼ˆè°ƒç”¨æ–¹ï¼‰
        â”œâ”€â”€ src/
        â”‚   â””â”€â”€ main.rs  # è¦è°ƒç”¨ European_Call
        â””â”€â”€ Cargo.toml
```

## åœ¨è°ƒç”¨æ–¹ï¼ˆC5ï¼‰çš„ `Cargo.toml` ä¸­æ·»åŠ ä¾èµ–

å› ä¸º `Calc` æ˜¯æœ¬åœ° crateï¼Œéœ€ç”¨ `path` æŒ‡å®šç›¸å¯¹è·¯å¾„

```toml
[package]
name = "C5"
version = "0.1.0"
edition = "2021"

[dependencies]
# å…³é”®ï¼šæ·»åŠ å¯¹ Calc crate çš„ä¾èµ–
Calc = { path = "../../Calc" }  # è·¯å¾„ä» C5/Cargo.toml æŒ‡å‘ Calc/Cargo.toml
```

- è·¯å¾„å†™æ³•ï¼š`../../Calc` è¡¨ç¤º â€œå‘ä¸Šä¸¤å±‚åˆ° AC ç›®å½•ï¼Œå†è¿›å…¥ Calc ç›®å½•â€

## åœ¨ C5 çš„ `main.rs` ä¸­è°ƒç”¨å‡½æ•°

é€šè¿‡ `use` å¯¼å…¥ `Calc` ä¸­çš„å…¬å¼€å‡½æ•°ï¼Œæˆ–ç›´æ¥é€šè¿‡ `crateå::å‡½æ•°å` è°ƒç”¨ï¼š

```rust
use Calc::European_Call;

fn main(){
    let call=European_Call(S,K,r,sigma,q,T);
    println!("{call:?}");
}
```

# åŒç«¯é˜Ÿåˆ—VecDequeçš„ä½¿ç”¨

Rustæ ‡å‡†åº“ä¸­çš„ `VecDeque`æ˜¯ä¸€ä¸ªåŸºäºå¯å¢é•¿ç¯å½¢ç¼“å†²åŒºå®ç°çš„åŒç«¯é˜Ÿåˆ—ï¼Œå®ƒå…è®¸åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨è¿›è¡Œé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ä»¥ä¸‹æ˜¯å…¶åŸºæœ¬ç”¨æ³•çš„è¯¦ç»†ä»‹ç»ã€‚

1. ğŸš€ åˆ›å»º VecDeque

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼åˆ›å»ºä¸€ä¸ª `VecDeque`ï¼š

| æ–¹æ³•                           | è¯´æ˜                                      | ç¤ºä¾‹ä»£ç                                             |
| ------------------------------ | ----------------------------------------- | --------------------------------------------------- |
| `VecDeque::new()`            | åˆ›å»ºä¸€ä¸ªç©ºçš„ `VecDeque`ã€‚               | `let mut deque: VecDeque<i32> = VecDeque::new();` |
| `VecDeque::with_capacity(n)` | åˆ›å»ºä¸€ä¸ªåˆå§‹å®¹é‡ä¸º `n`çš„ `VecDeque`ã€‚ | `let mut deque = VecDeque::with_capacity(10);`    |
| `VecDeque::from([x, y, z])`  | ä»æ•°ç»„æˆ–å‘é‡ç›´æ¥è½¬æ¢åˆ›å»ºã€‚                | `let deq = VecDeque::from([1, 2, 3]);`            |

2. â• æ·»åŠ å…ƒç´ 

`VecDeque`çš„æ ¸å¿ƒç‰¹æ€§æ˜¯æ”¯æŒåœ¨ä¸¤ç«¯é«˜æ•ˆæ·»åŠ å…ƒç´ ã€‚

- **åœ¨å°¾éƒ¨æ·»åŠ **ï¼šä½¿ç”¨ `push_back`æ–¹æ³•ã€‚
- **åœ¨å¤´éƒ¨æ·»åŠ **ï¼šä½¿ç”¨ `push_front`æ–¹æ³•ã€‚è¿™ä¸æ™®é€šé˜Ÿåˆ—ï¼ˆä»…æ”¯æŒå°¾éƒ¨æ·»åŠ ï¼‰ä¸åŒï¼Œæ˜¯å…¶â€œåŒç«¯â€èƒ½åŠ›çš„ä½“ç°ã€‚

```rust
use std::collections::VecDeque;

let mut deque = VecDeque::new();
deque.push_back('a'); // é˜Ÿåˆ—: [a]
deque.push_front('b'); // é˜Ÿåˆ—: [b, a]
deque.push_back('c'); // é˜Ÿåˆ—: [b, a, c]
```

3. â– åˆ é™¤å…ƒç´ 

ç›¸åº”åœ°ï¼Œä½ ä¹Ÿå¯ä»¥ä»ä¸¤ç«¯ç§»é™¤å…ƒç´ ã€‚

- **ä»å°¾éƒ¨ç§»é™¤**ï¼šä½¿ç”¨ `pop_back`æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª `Option<T>`ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™è¿”å› `None`ã€‚
- **ä»å¤´éƒ¨ç§»é™¤**ï¼šä½¿ç”¨ `pop_front`æ–¹æ³•ï¼ŒåŒæ ·è¿”å› `Option<T>`ã€‚

```rust
let mut deque = VecDeque::from(['b', 'a', 'c']);
assert_eq!(deque.pop_front(), Some('b')); // ç§»é™¤å¹¶è¿”å›å¤´éƒ¨å…ƒç´  'b'
assert_eq!(deque.pop_back(), Some('c')); // ç§»é™¤å¹¶è¿”å›å°¾éƒ¨å…ƒç´  'c'
assert_eq!(deque.pop_back(), Some('a')); // ç§»é™¤å¹¶è¿”å›å°¾éƒ¨å…ƒç´  'a'
assert_eq!(deque.pop_back(), None); // é˜Ÿåˆ—å·²ç©ºï¼Œè¿”å› None
```

4. ğŸ‘€ è®¿é—®å…ƒç´ 

ä½ å¯ä»¥å®‰å…¨åœ°æŸ¥çœ‹æˆ–è·å–é˜Ÿåˆ—ä¸¤ç«¯çš„å…ƒç´ ï¼Œè€Œä¸ä¼šç§»é™¤å®ƒä»¬ã€‚

- **æŸ¥çœ‹å¤´éƒ¨å…ƒç´ **ï¼šä½¿ç”¨ `front()`æ–¹æ³•ï¼Œè¿”å› `Option<&T>`ã€‚
- **æŸ¥çœ‹å°¾éƒ¨å…ƒç´ **ï¼šä½¿ç”¨ `back()`æ–¹æ³•ï¼Œè¿”å› `Option<&T>`ã€‚
- **é€šè¿‡ç´¢å¼•è®¿é—®**ï¼šä½¿ç”¨ `get(index)`æ–¹æ³•è·å–æŒ‡å®šç´¢å¼•å¤„å…ƒç´ çš„ä¸å¯å˜å¼•ç”¨ï¼Œæˆ–ä½¿ç”¨ `get_mut(index)`è·å–å¯å˜å¼•ç”¨ã€‚ä½¿ç”¨ç´¢å¼•è¯­æ³• `deque[index]`åœ¨è¶Šç•Œæ—¶ä¼šç›´æ¥è§¦å‘ panicã€‚

```rust
let mut deque = VecDeque::from([10, 20, 30]);
// æŸ¥çœ‹å…ƒç´ 
assert_eq!(deque.front(), Some(&10));
assert_eq!(deque.back(), Some(&30));
// é€šè¿‡ç´¢å¼•è·å–å’Œä¿®æ”¹
if let Some(elem) = deque.get_mut(1) {
    *elem = 25; // å°†ç´¢å¼•1å¤„çš„å…ƒç´ ä»20ä¿®æ”¹ä¸º25
}
assert_eq!(deque[1], 25);
```

5. ğŸ” å…¶ä»–å®ç”¨æ“ä½œ

`VecDeque`è¿˜æä¾›äº†ä¸€äº›å…¶ä»–å¸¸ç”¨æ–¹æ³•ï¼š

- **`len()`**: è¿”å›é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ•°é‡ã€‚
- **`is_empty()`**: æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚
- **`swap(i, j)`**: äº¤æ¢ç´¢å¼• `i`å’Œ `j`å¤„çš„ä¸¤ä¸ªå…ƒç´ ã€‚
- **`clear()`**: æ¸…ç©ºé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚
- **`iter()`**: è¿”å›ä¸€ä¸ªç”¨äºéå†é˜Ÿåˆ—å…ƒç´ çš„è¿­ä»£å™¨ã€‚

6. ğŸ’¡ æ ¸å¿ƒè¦ç‚¹ä¸ä½¿ç”¨åœºæ™¯

- **é«˜æ€§èƒ½**ï¼šåœ¨é˜Ÿåˆ—ä¸¤ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œéå¸¸é«˜æ•ˆã€‚ä½†å½“å®¹é‡ä¸è¶³éœ€è¦æ‰©å®¹æ—¶ï¼Œä¼šå‘ç”Ÿ O(n) çš„æ—¶é—´å¤æ‚åº¦æ“ä½œã€‚
- **é¢„åˆ†é…å®¹é‡**ï¼šå¦‚æœä½ èƒ½é¢„ä¼°é˜Ÿåˆ—çš„å¤§è‡´å¤§å°ï¼Œä½¿ç”¨ `VecDeque::with_capacity`æˆ– `reserve`æ–¹æ³•é¢„å…ˆåˆ†é…ç©ºé—´å¯ä»¥é¿å…åœ¨è¿è¡Œæ—¶å¤šæ¬¡æ‰©å®¹ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼š`VecDeque`éå¸¸é€‚åˆéœ€è¦åŒæ—¶ä½œä¸ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰å’Œæ ˆï¼ˆLIFOï¼‰ä½¿ç”¨çš„åœºæ™¯ï¼Œæˆ–è€…éœ€è¦é¢‘ç¹åœ¨åºåˆ—ä¸¤ç«¯è¿›è¡Œæ“ä½œçš„ç®—æ³•ã€‚é€šå¸¸ï¼Œå®ƒæ¯”é“¾è¡¨ï¼ˆ`LinkedList`ï¼‰æœ‰æ›´å¥½çš„å†…å­˜å±€éƒ¨æ€§å’Œç¼“å­˜å‹å¥½æ€§ï¼Œæ˜¯æ›´æ¨èä½¿ç”¨çš„åŒç«¯æ•°æ®ç»“æ„ã€‚

å¸Œæœ›è¿™äº›ä»‹ç»èƒ½å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Rust æ ‡å‡†åº“ä¸­çš„ `VecDeque`ã€‚å¦‚æœä½ å¯¹ç‰¹å®šæ–¹æ³•çš„ç»†èŠ‚æˆ–æ›´é«˜çº§çš„ç”¨æ³•ï¼ˆå¦‚èŒƒå›´æ“ä½œ `range_mut`æˆ–é˜Ÿåˆ—åˆå¹¶ `append`ç­‰ï¼‰æœ‰è¿›ä¸€æ­¥å…´è¶£ï¼Œæˆ‘å¯ä»¥ä¸ºä½ æä¾›æ›´è¯¦ç»†çš„è¯´æ˜ã€‚

# ç»˜å›¾

```plaintext
cargo add plotters
```

ä»¥ç”»æ•£ç‚¹è¿æ¥å›¾ä¸ºä¾‹

## æ•´ä½“ç¤ºä¾‹ä»£ç 

```rust
use plotters::prelude::*;
fn main(){
    let r:f64=0.05;
    let rf=0.1;
    let X:f64=2.0;

    let t_values: Vec<f64> = (1..=20).map(|x| x as f64 * 0.1).collect(); // T = 0.1, 0.2, ..., 2.0
    let f_values:Vec<f64>=t_values.iter().map(|&t| X*((r-rf)*t).exp()).collect();
    // ä½¿ç”¨ fold æ‰‹åŠ¨è®¡ç®—æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œä»¥é¿å… Ord trait çš„é™åˆ¶
    let min_forward = f_values
        .iter()
        .fold(f64::INFINITY, |a, &b| a.min(b)); // åˆå§‹å€¼è®¾ä¸ºæ— ç©·å¤§ï¼Œç„¶åä¸æ–­å–è¾ƒå°å€¼

    let max_forward = f_values
        .iter()
        .fold(f64::NEG_INFINITY, |a, &b| a.max(b)); // åˆå§‹å€¼è®¾ä¸ºè´Ÿæ— ç©·å¤§ï¼Œç„¶åä¸æ–­å–è¾ƒå¤§å€¼

    println!("\nMaturity (T)\tForward Rate (F)");
    for (t,f) in t_values.iter().zip(f_values.iter()){
        println!("{:.1}\t\t{:.6}",t,f);
    }
    let root=BitMapBackend::new("forward_plot.png", (800, 600)).into_drawing_area();
    root.fill(&WHITE).unwrap();

    let mut chart = ChartBuilder::on(&root)
        .caption("Forward Exchange Rate vs. Maturity",("sans-serif",30))
        .margin(10)
        .x_label_area_size(40)
        .y_label_area_size(40)
        .build_cartesian_2d(0.0..2.1,min_forward*0.95..max_forward*1.05)
        .unwrap();
    chart.configure_mesh().draw().unwrap();
    chart.draw_series(
        t_values
            .iter()
            .zip(f_values.iter())
            .map(|(&x, &y)| Circle::new((x, y), 3, BLUE.filled()))
    ).unwrap();
    chart.draw_series(LineSeries::new(
        t_values.iter().zip(f_values.iter()).map(|(&t,&f)| (t,f)),
        &RED,
    )).unwrap();
    println!("\nPlot saved as 'forward_plot.png'");
}
```

## å‡†å¤‡æ•°æ®

```rust
    let r:f64=0.05;
    let rf=0.1;
    let X:f64=2.0;

    let t_values: Vec<f64> = (1..=20).map(|x| x as f64 * 0.1).collect(); // T = 0.1, 0.2, ..., 2.0
    let f_values:Vec<f64>=t_values.iter().map(|&t| X*((r-rf)*t).exp()).collect();
    // ä½¿ç”¨ fold æ‰‹åŠ¨è®¡ç®—æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œä»¥é¿å… Ord trait çš„é™åˆ¶
    let min_forward = f_values
        .iter()
        .fold(f64::INFINITY, |a, &b| a.min(b)); // åˆå§‹å€¼è®¾ä¸ºæ— ç©·å¤§ï¼Œç„¶åä¸æ–­å–è¾ƒå°å€¼

    let max_forward = f_values
        .iter()
        .fold(f64::NEG_INFINITY, |a, &b| a.max(b)); // åˆå§‹å€¼è®¾ä¸ºè´Ÿæ— ç©·å¤§ï¼Œç„¶åä¸æ–­å–è¾ƒå¤§å€¼

    println!("\nMaturity (T)\tForward Rate (F)");
    for (t,f) in t_values.iter().zip(f_values.iter()){
        println!("{:.1}\t\t{:.6}",t,f);
    }
```

## ç»˜åˆ¶

```rust
let root=BitMapBackend::new("forward_plot.png", (800, 600)).into_drawing_area();
```

`BitMapBackend` æ˜¯ `plotters` åº“ä¸­çš„ä¸€ä¸ª**ç»˜å›¾åç«¯ï¼ˆBackendï¼‰** ï¼Œä¸“é—¨ç”¨äºç”Ÿæˆ **ä½å›¾å›¾åƒï¼ˆå¦‚ PNGã€JPGï¼‰** ã€‚

* åç«¯çš„ä½œç”¨ï¼šå®šä¹‰å›¾è¡¨çš„ **è¾“å‡ºæ ¼å¼** å’Œ  **å­˜å‚¨æ–¹å¼** ï¼ˆè¿™é‡Œæ˜¯ â€œä¿å­˜ä¸º PNG æ–‡ä»¶â€ï¼‰ã€‚
* `BitMapBackend` ç»§æ‰¿è‡ª `plotters` çš„é€šç”¨åç«¯ traitï¼Œæä¾›äº†å°†ç»˜å›¾æŒ‡ä»¤ï¼ˆå¦‚ â€œç”»ç‚¹â€â€œç”»çº¿â€ï¼‰è½¬æ¢ä¸ºåƒç´ æ•°æ®çš„èƒ½åŠ›ã€‚

**é™æ€æ–¹æ³•ï¼š`BitMapBackend::new(...)**`

    `::new` æ˜¯ `BitMapBackend` çš„  **é™æ€æ„é€ æ–¹æ³•** ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„åç«¯å®ä¾‹ã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

+ å‚æ•° 1ï¼š`"forward_plot.png"`

  æŒ‡å®šç»˜å›¾å®Œæˆåï¼Œå›¾åƒæ–‡ä»¶çš„**ä¿å­˜è·¯å¾„** å’Œ  **æ–‡ä»¶å** ã€‚

  è¿™é‡Œæ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆä¸ç¨‹åºè¿è¡Œç›®å½•åŒçº§ï¼‰ï¼Œè¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º `forward_plot.png` çš„æ–‡ä»¶ã€‚

  è‹¥æŒ‡å®šè·¯å¾„ï¼ˆå¦‚ `"./images/forward_plot.png"`ï¼‰ï¼Œéœ€ç¡®ä¿ç›®å½•å·²å­˜åœ¨ï¼ˆå¦åˆ™ä¼šæŠ¥é”™ï¼‰ã€‚
+ å‚æ•° 2ï¼š`(800, 600)`

  æŒ‡å®šå›¾åƒçš„**åˆ†è¾¨ç‡** ï¼šå®½ 800 åƒç´ ï¼Œé«˜ 600 åƒç´ ã€‚

  å°ºå¯¸è¶Šå¤§ï¼Œå›¾åƒè¶Šæ¸…æ™°ï¼Œä½†æ–‡ä»¶ä½“ç§¯ä¹Ÿä¼šè¶Šå¤§ã€‚å¸¸è§å°ºå¯¸å¦‚ `(640, 480)`ï¼ˆæ ‡å‡†ï¼‰ã€`(1024, 768)`ï¼ˆé«˜æ¸…ï¼‰ã€‚

**æ–¹æ³•è°ƒç”¨ï¼š`.into_drawing_area()**`

è¿™æ˜¯å…³é”®çš„ä¸€æ­¥ï¼Œä½œç”¨æ˜¯  **å°† â€œåç«¯å®ä¾‹â€ è½¬æ¢ä¸º â€œç»˜å›¾åŒºåŸŸï¼ˆDrawingAreaï¼‰â€** ã€‚

æˆ‘ä»¬éœ€è¦å…ˆç†è§£ `plotters` çš„æ ¸å¿ƒè®¾è®¡ï¼š **â€œåç«¯ï¼ˆBackendï¼‰â€ è´Ÿè´£è¾“å‡ºï¼Œâ€œç»˜å›¾åŒºåŸŸï¼ˆDrawingAreaï¼‰â€ è´Ÿè´£ç»˜åˆ¶** ã€‚

ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢ï¼Ÿ

* `BitMapBackend` åªå…³å¿ƒ â€œå¦‚ä½•å°†åƒç´ å†™å…¥æ–‡ä»¶â€ï¼Œä¸æä¾›ç»˜å›¾é€»è¾‘ï¼ˆå¦‚å¡«å……é¢œè‰²ã€ç”»å›¾å½¢ï¼‰ã€‚
* `DrawingArea` æ˜¯ä¸€ä¸ª  **æŠ½è±¡çš„ç»˜å›¾æ¥å£** ï¼Œå®ƒå°è£…äº† â€œåœ¨æŒ‡å®šåŒºåŸŸå†…ç»˜å›¾â€ çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆå¦‚ `fill` å¡«å……é¢œè‰²ã€`draw_series` ç»˜åˆ¶æ•°æ®ç³»åˆ—ï¼‰ï¼Œä¸”ä¸å…·ä½“åç«¯æ— å…³ï¼ˆæ¢ `SVGBackend` ä¹Ÿèƒ½å¤ç”¨åŒä¸€å¥—ç»˜å›¾é€»è¾‘ï¼‰ã€‚

`into_drawing_area()` çš„ä½œç”¨ï¼š

* ä» `BitMapBackend` ä¸­æå–å‡ºä¸€ä¸ª  **â€œæ ¹ç»˜å›¾åŒºåŸŸâ€** ï¼ˆæ•´ä¸ªå›¾åƒçš„çŸ©å½¢åŒºåŸŸï¼‰ã€‚
* è¿™ä¸ªåŒºåŸŸçš„å°ºå¯¸å°±æ˜¯ `BitMapBackend::new` æŒ‡å®šçš„ `(800, 600)`ï¼Œåç»­æ‰€æœ‰ç»˜å›¾æ“ä½œéƒ½åœ¨è¿™ä¸ªåŒºåŸŸå†…è¿›è¡Œã€‚
* è¿”å›çš„ `DrawingArea` å¯¹è±¡ä¼šè¢«èµ‹å€¼ç»™å˜é‡ `root`ï¼Œä½œä¸ºåç»­ç»˜å›¾çš„ â€œåŸºç¡€ç”»å¸ƒâ€ã€‚

æ•´ä½“æµç¨‹æ€»ç»“

è¿™è¡Œä»£ç çš„æ‰§è¡Œé€»è¾‘æ˜¯ï¼š

1. å‘Šè¯‰ `plotters`ï¼šâ€œæˆ‘è¦ç”Ÿæˆä¸€ä¸ªåä¸º `forward_plot.png`ã€å°ºå¯¸ 800Ã—600 çš„ PNG å›¾åƒâ€ï¼ˆé€šè¿‡ `BitMapBackend::new`ï¼‰ã€‚
2. ä»è¿™ä¸ª PNG åç«¯ä¸­ï¼Œè·å–ä¸€ä¸ª â€œå¯ä»¥ç›´æ¥ç»˜å›¾çš„ 800Ã—600 åƒç´ ç”»å¸ƒâ€ï¼ˆé€šè¿‡ `into_drawing_area()`ï¼‰ã€‚
3. å°†è¿™ä¸ªç”»å¸ƒå‘½åä¸º `root`ï¼Œåç»­æ‰€æœ‰ç»˜å›¾æ“ä½œéƒ½åŸºäºè¿™ä¸ªç”»å¸ƒå±•å¼€ã€‚

```rust
root.fill(&WHITE).unwrap();
```

`.fill(&WHITE)`ï¼šå¡«å……èƒŒæ™¯è‰²

```rust
 let mut chart = ChartBuilder::on(&root)
        .caption("Forward Exchange Rate vs. Maturity",("sans-serif",30))
        .margin(10)
        .x_label_area_size(40)
        .y_label_area_size(40)
        .build_cartesian_2d(0.0..2.1,min_forward*0.95..max_forward*1.05)
        .unwrap();
```

å…³é”®å‚æ•°è¯´æ˜

1. **`ChartBuilder::on(&root)`**

* åŸºäºå·²åˆ›å»ºçš„ `root`ç»˜å›¾åŒºåŸŸï¼ˆå¦‚ `BitMapBackend`ï¼‰åˆå§‹åŒ–å›¾è¡¨æ„å»ºå™¨ã€‚

2. **`.caption(...)`**

* **æ ‡é¢˜å†…å®¹** ï¼š`"Forward Exchange Rate vs. Maturity"`
* **å­—ä½“æ ·å¼** ï¼š`("sans-serif", 30)`è¡¨ç¤ºä½¿ç”¨æ— è¡¬çº¿å­—ä½“ï¼Œå­—å· 30ã€‚

3. **`.margin(10)`**

* è®¾ç½®å›¾è¡¨å››å‘¨çš„è¾¹è·ä¸º 10 åƒç´ ï¼Œé˜²æ­¢æ ‡ç­¾è¢«è£å‰ªã€‚

4. **`.x_label_area_size(40)`**

* Xè½´æ ‡ç­¾åŒºåŸŸå®½åº¦ä¸º 40 åƒç´ ï¼Œç¡®ä¿æœŸé™æ ‡ç­¾ï¼ˆå¦‚ `0.1`, `0.2`å¹´ï¼‰æœ‰è¶³å¤Ÿæ˜¾ç¤ºç©ºé—´ã€‚

5. **`.y_label_area_size(40)`**

* Yè½´æ ‡ç­¾åŒºåŸŸé«˜åº¦ä¸º 40 åƒç´ ï¼Œç”¨äºæ˜¾ç¤ºè¿œæœŸæ±‡ç‡æ•°å€¼ã€‚

6. **`.build_cartesian_2d(...)`**

* **Xè½´èŒƒå›´** ï¼š`0.0..2.1`è¡¨ç¤ºæœŸé™ä» 0 åˆ° 2.1 å¹´ï¼ˆè¦†ç›– `t_values`çš„ `0.1`åˆ° `2.0`æ­¥é•¿ï¼‰ã€‚
* **Yè½´èŒƒå›´** ï¼šåŠ¨æ€è®¡ç®—ï¼š

    *`min_forward`æ˜¯ `f_values`çš„æœ€å°å€¼ï¼Œ`max_forward`æ˜¯æœ€å¤§å€¼ã€‚
     * `0.95`å’Œ `1.05`ä¸ºæ‰©å±•å› å­ï¼Œä½¿å›¾è¡¨ä¸Šä¸‹ç•™å‡º 5% ç©ºç™½ï¼Œé¿å…æ•°æ®ç‚¹ç´§è´´è¾¹ç¼˜ã€‚

```rust
chart.configure_mesh().draw().unwrap();

chart.configure_mesh()
    .x_labels(10)              // Xè½´æ˜¾ç¤º10ä¸ªåˆ»åº¦æ ‡ç­¾
    .y_labels(5)               // Yè½´æ˜¾ç¤º5ä¸ªåˆ»åº¦æ ‡ç­¾
    .light_line_style(&TRANSPARENT)  // å‰¯ç½‘æ ¼çº¿è®¾ä¸ºé€æ˜
    .bold_line_style(&RED.mix(0.5))  // ä¸»ç½‘æ ¼çº¿è®¾ä¸ºåŠé€æ˜çº¢è‰²
    .disable_x_mesh()          // ç¦ç”¨Xè½´ç½‘æ ¼çº¿
    .draw()?;                  // åº”ç”¨é…ç½®ï¼ˆéœ€é”™è¯¯å¤„ç†ï¼‰
```

è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯ **é…ç½®å¹¶ç»˜åˆ¶å›¾è¡¨çš„ç½‘æ ¼ç³»ç»Ÿ**

```rust
chart.draw_series(
    t_values
        .iter()
        .zip(f_values.iter())  // 1. å‹ç¼©é…å¯¹ä¸¤ä¸ªæ•°ç»„çš„è¿­ä»£å™¨
        .map(|(&x, &y)| Circle::new((x, y), 3, BLUE.filled()))  // 2. è½¬æ¢ä¸º Circle å…ƒç´ 
).unwrap();  // 3. é”™è¯¯å¤„ç†
```

**é—­åŒ…å‚æ•°** ï¼š`|&x, &y|`è§£æ„å…ƒç»„ä¸­çš„ `t`å’Œ `f`å€¼ï¼ˆé€šè¿‡ `&`è§£å¼•ç”¨ï¼‰ã€‚

 **Circle æ„é€ ** ï¼š

* **åœ†å¿ƒåæ ‡** ï¼š`(x, y)`ï¼Œå¯¹åº”æ•°æ®ç‚¹çš„ä½ç½®ã€‚
* **åŠå¾„** ï¼š`3`åƒç´ ï¼Œæ§åˆ¶ç‚¹çš„å¤§å°ã€‚
* **æ ·å¼** ï¼š`BLUE.filled()`è¡¨ç¤ºè“è‰²å®å¿ƒå¡«å……ï¼ˆå¯¹æ¯” `BLUE.stroke()`ä»…ç»˜åˆ¶è¾¹æ¡†ï¼‰

```rust
    chart.draw_series(LineSeries::new(
        t_values.iter().zip(f_values.iter()).map(|(&t,&f)| (t,f)),
        &RED,
    )).unwrap();
```

è¿™è¡Œä»£ç çš„å®Œæ•´æ‰§è¡Œé€»è¾‘æ˜¯ï¼š

1. é€šè¿‡ `t_values.iter().zip(f_values.iter()).map(...)` ç”Ÿæˆä¸€ç³»åˆ— `(x, y)` åæ ‡ç‚¹ã€‚
2. ä½¿ç”¨ `LineSeries::new(...)` å’Œè¿™äº›åæ ‡ç‚¹ä»¥åŠçº¢è‰²æ ·å¼ï¼Œåˆ›å»ºä¸€ä¸ªæŠ˜çº¿å›¾æ•°æ®ç³»åˆ—ã€‚
3. è°ƒç”¨ `chart.draw_series()` æ–¹æ³•ï¼Œå°†è¿™ä¸ªçº¢è‰²æŠ˜çº¿ç³»åˆ—ç»˜åˆ¶åˆ° `chart` å›¾è¡¨å¯¹è±¡ä¸Šã€‚
4. ä½¿ç”¨ `.unwrap()` å¤„ç†ç»˜åˆ¶è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚



# &mutå’Œref mutçš„åŒºåˆ«

è¦å½»åº•åŒºåˆ† Rust ä¸­çš„ `&mut` å’Œ `ref mut`ï¼Œæ ¸å¿ƒæ˜¯æŠ“ä½å®ƒä»¬çš„**æœ¬è´¨è§’è‰²**å’Œ**ä½¿ç”¨ä¸Šä¸‹æ–‡**â€”â€”å‰è€…æ˜¯â€œåˆ›å»º/æ ‡æ³¨å¯å˜å¼•ç”¨çš„è¿ç®—ç¬¦â€ï¼Œåè€…æ˜¯â€œæ¨¡å¼åŒ¹é…ä¸­ç»‘å®šå¯å˜å¼•ç”¨çš„å…³é”®å­—â€ã€‚ä¸‹é¢åˆ†ç»´åº¦è¯¦ç»†æ‹†è§£ï¼Œå¹¶ç»“åˆç¤ºä¾‹è¯´æ˜ã€‚

ä¸€ã€æ ¸å¿ƒæœ¬è´¨ï¼šè§’è‰²å®Œå…¨ä¸åŒ

|è¯­æ³•|æœ¬è´¨|æ ¸å¿ƒç›®çš„|
|---|---|---|
|`&mut`|å¯å˜å¼•ç”¨è¿ç®—ç¬¦ï¼ˆè¡¨è¾¾å¼/ç±»å‹ï¼‰|ä¸»åŠ¨**åˆ›å»º**å¯å˜å¼•ç”¨ï¼Œæˆ–**æ ‡æ³¨**å¯å˜å¼•ç”¨ç±»å‹|
|`ref mut`|æ¨¡å¼ç»‘å®šå…³é”®å­—|åœ¨æ¨¡å¼åŒ¹é…ä¸­ï¼Œå°†å€¼**ä»¥å¯å˜å¼•ç”¨çš„æ–¹å¼ç»‘å®š**åˆ°å˜é‡ï¼ˆä¸è·å–æ‰€æœ‰æƒï¼‰|
äºŒã€ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼šåœºæ™¯æ³¾æ¸­åˆ†æ˜

`&mut` å’Œ `ref mut` çš„æ ¸å¿ƒå·®å¼‚ä½“ç°åœ¨**èƒ½å†™åœ¨å“ªé‡Œ**ï¼Œè¿™ä¹Ÿæ˜¯æœ€å®¹æ˜“æ··æ·†çš„ç‚¹ã€‚

1. `&mut`ï¼šè¡¨è¾¾å¼/ç±»å‹æ ‡æ³¨åœºæ™¯

`&mut` æœ‰ä¸¤ä¸ªæ ¸å¿ƒç”¨æ³•ï¼Œéƒ½è„±ç¦»ä¸äº†â€œè¡¨è¾¾å¼â€æˆ–â€œç±»å‹â€ä¸Šä¸‹æ–‡ï¼š

- **è¡¨è¾¾å¼ä¸­**ï¼šåˆ›å»ºæŒ‡å‘å€¼çš„å¯å˜å¼•ç”¨ï¼ˆç”Ÿæˆ `&mut T` ç±»å‹çš„å€¼ï¼‰ï¼›

- **ç±»å‹æ ‡æ³¨ä¸­**ï¼šå£°æ˜å˜é‡/å‚æ•°çš„ç±»å‹æ˜¯å¯å˜å¼•ç”¨ã€‚

**ç¤ºä¾‹1ï¼šè¡¨è¾¾å¼ä¸­åˆ›å»ºå¯å˜å¼•ç”¨**

```Rust
fn main() {
    let mut x = 10; // å¿…é¡»å…ˆå£°æ˜ä¸ºmutï¼Œæ‰èƒ½åˆ›å»ºå¯å˜å¼•ç”¨
    let y: &mut i32 = &mut x; // &mut xï¼šåˆ›å»ºxçš„å¯å˜å¼•ç”¨ï¼Œyçš„ç±»å‹æ˜¯&mut i32
    *y += 5; // è§£å¼•ç”¨ä¿®æ”¹å€¼
    println!("x: {}", x); // è¾“å‡º 15ï¼ˆxè¢«ä¿®æ”¹ï¼‰
}
```

**ç¤ºä¾‹2ï¼šå‡½æ•°å‚æ•°çš„ç±»å‹æ ‡æ³¨**

```rust
// å‡½æ•°å‚æ•°ç±»å‹æ ‡æ³¨ä¸º&mut i32ï¼ˆå¯å˜å¼•ç”¨ï¼‰
fn modify(v: &mut i32) {
    *v += 1;
}

fn main() {
    let mut x = 5;
    modify(&mut x); // ä¼ å‚æ—¶ç”¨&mutåˆ›å»ºå¯å˜å¼•ç”¨ä¼ å…¥
    println!("x: {}", x); // è¾“å‡º 6
}
```



#### 2. `ref mut`ï¼šä»…æ¨¡å¼åŒ¹é…åœºæ™¯

`ref mut` æ˜¯**æ¨¡å¼å…³é”®å­—**ï¼Œåªèƒ½ç”¨åœ¨ã€Œæ¨¡å¼ä½ç½®ã€ï¼ˆ`let` ç»‘å®šã€`match`/`if let` è§£æ„ã€å‡½æ•°å‚æ•°æ¨¡å¼ç­‰ï¼‰ï¼Œç›®çš„æ˜¯â€œåœ¨è§£æ„/ç»‘å®šå€¼æ—¶ï¼Œä¸æ‹¿æ‰€æœ‰æƒï¼Œåªç»‘å®šå¯å˜å¼•ç”¨â€ã€‚

æ¨¡å¼ä½ç½®çš„å…¸å‹åœºæ™¯ï¼š

- `let` ç»‘å®šè¯­å¥çš„å·¦ä¾§ï¼ˆæ¨¡å¼ä½ï¼‰ï¼›

- `match`/`if let` çš„åŒ¹é…åˆ†æ”¯ä¸­ï¼›

- å‡½æ•°å‚æ•°çš„æ¨¡å¼ä½ï¼ˆå°‘è§ä½†åˆæ³•ï¼‰ã€‚

**ç¤ºä¾‹1ï¼šlet ç»‘å®šä¸­ä½¿ç”¨ ref mut**

```Rust
fn main() {
    let mut x = 10;
    // ref mut yï¼šæ¨¡å¼ç»‘å®šï¼Œå°†xä»¥å¯å˜å¼•ç”¨çš„æ–¹å¼ç»‘å®šåˆ°yï¼ˆç­‰ä»·äº let y = &mut xï¼‰
    let ref mut y = x;
    *y += 5;
    println!("x: {}", x); // è¾“å‡º 15
}
```

è¿™é‡Œ `let ref mut y = x` å’Œ `let y = &mut x` æ•ˆæœå®Œå…¨ç­‰ä»·ï¼Œä½†å‰è€…æ˜¯â€œæ¨¡å¼å±‚é¢çš„ç»‘å®šâ€ï¼Œåè€…æ˜¯â€œè¡¨è¾¾å¼å±‚é¢çš„åˆ›å»ºâ€ã€‚

**ç¤ºä¾‹2ï¼šmatch è§£æ„ä¸­ä½¿ç”¨ ref mutï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰**

è¿™æ˜¯ `ref mut` æœ€ä¸å¯æ›¿ä»£çš„åœºæ™¯â€”â€”è§£æ„ç»“æ„ä½“/æšä¸¾æ—¶ï¼Œéœ€è¦ç»‘å®šå­—æ®µçš„å¯å˜å¼•ç”¨ï¼ˆè€Œéæ‹¿èµ°æ‰€æœ‰æƒï¼‰ã€‚

```Rust
#[derive(Debug)]
struct User {
    name: String,
    age: i32,
}

fn main() {
    let mut user = User {
        name: "Alice".to_string(),
        age: 20,
    };

    // è§£æ„Userï¼Œç”¨ref mutç»‘å®šageçš„å¯å˜å¼•ç”¨ï¼ˆä¸æ‹¿æ‰€æœ‰æƒï¼‰
    match user {
        User { ref mut age, name } => {
            *age += 1; // ä¿®æ”¹ageçš„å€¼
            println!("name: {}", name); // nameæ‹¿èµ°äº†æ‰€æœ‰æƒï¼ˆå› ä¸ºæ²¡åŠ ref/ref mutï¼‰
        }
    }

    println!("user: {:?}", user); // è¾“å‡º User { name: "", age: 21 }ï¼ˆnameå·²è¢«moveï¼Œageè¢«ä¿®æ”¹ï¼‰
}
```

å¦‚æœä¸ç”¨ `ref mut`ï¼Œç›´æ¥å†™ `age` ä¼š**æ‹¿èµ°æ‰€æœ‰æƒ**ï¼ˆè‹¥å­—æ®µæ—  `Copy` åˆ™æŠ¥é”™ï¼‰ï¼š

```Rust
// é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•æ‹¿èµ°ageçš„æ‰€æœ‰æƒï¼ˆi32æ˜¯Copyï¼Œæ‰€ä»¥ä¸æŠ¥é”™ï¼Œä½†é€»è¾‘ä¸Šä¸ç¬¦åˆâ€œä»…ä¿®æ”¹â€çš„æ„å›¾ï¼‰
// è‹¥å­—æ®µæ˜¯Stringï¼ˆæ— Copyï¼‰ï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼šuse of moved value: `user`
match user {
    User { age, name } => {
        age += 1; // è¿™é‡Œä¿®æ”¹çš„æ˜¯æ‹·è´çš„ageï¼ŒåŸuser.ageä¸å˜
    }
}
println!("user: {:?}", user); // ageä»ä¸º20
```

**ç¤ºä¾‹3ï¼šæšä¸¾è§£æ„ä¸­çš„ ref mut**

```Rust
enum Data {
    Number(i32),
    Text(String),
}

fn main() {
    let mut data = Data::Text("hello".to_string());

    match data {
        // ç»‘å®šsä¸º&mut Stringï¼Œä¸æ‹¿æ‰€æœ‰æƒ
        Data::Text(ref mut s) => {
            s.push_str(" world"); // ä¿®æ”¹åŸå­—ç¬¦ä¸²
        }
        Data::Number(ref mut n) => {
            *n *= 2;
        }
    }

    println!("{:?}", data); // è¾“å‡º Text("hello world")
}
```

ä¸‰ã€å…³é”®åŒºåˆ«æ€»ç»“

|ç»´åº¦|`&mut`|`ref mut`|
|---|---|---|
|è§’è‰²|è¿ç®—ç¬¦ï¼ˆè¡¨è¾¾å¼/ç±»å‹ï¼‰|æ¨¡å¼å…³é”®å­—|
|ä¸Šä¸‹æ–‡|è¡¨è¾¾å¼ï¼ˆåˆ›å»ºå¼•ç”¨ï¼‰ã€ç±»å‹æ ‡æ³¨|ä»…æ¨¡å¼ä½ç½®ï¼ˆlet/match/å‡½æ•°å‚æ•°æ¨¡å¼ï¼‰|
|æ ¸å¿ƒä½œç”¨|ä¸»åŠ¨åˆ›å»º/æ ‡æ³¨å¯å˜å¼•ç”¨|æ¨¡å¼åŒ¹é…ä¸­ç»‘å®šå¯å˜å¼•ç”¨ï¼ˆä¸æ‹¿æ‰€æœ‰æƒï¼‰|
|ä¸å¯æ›¿ä»£æ€§|é€šç”¨åœºæ™¯å¿…å¤‡|æ¨¡å¼è§£æ„æ—¶ç»‘å®šå¼•ç”¨çš„æ ¸å¿ƒæ–¹å¼|
å››ã€å¸¸è§è¯¯åŒºæ¾„æ¸…

1. **è¯¯åŒº1**ï¼š`ref mut` æ˜¯ `&mut` çš„è¯­æ³•ç³–ï¼Ÿ

    - ä»…åœ¨ `let` ç»‘å®šä¸­çœ‹ä¼¼ç­‰ä»·ï¼ˆ`let ref mut y = x` â‰ˆ `let y = &mut x`ï¼‰ï¼Œä½† `ref mut` æ˜¯æ¨¡å¼å±‚é¢çš„ç»‘å®šï¼Œ`&mut` æ˜¯è¡¨è¾¾å¼å±‚é¢çš„åˆ›å»ºï¼›

    - æ¨¡å¼è§£æ„ï¼ˆå¦‚ `match` ç»“æ„ä½“/æšä¸¾ï¼‰æ—¶ï¼Œ`ref mut` æ— æ³•è¢« `&mut` æ›¿ä»£ï¼ˆ`&mut` åªèƒ½å…ˆåˆ›å»ºå¼•ç”¨å†åŒ¹é…ï¼Œè€Œéç›´æ¥è§£æ„ç»‘å®šï¼‰ã€‚

2. **è¯¯åŒº2**ï¼š`ref mut` ä¼šåˆ›å»ºæ–°å¼•ç”¨ï¼Ÿ

    - æœ¬è´¨æ˜¯â€œç»‘å®šå·²æœ‰å€¼çš„å¼•ç”¨â€ï¼Œå’Œ `&mut` åˆ›å»ºå¼•ç”¨çš„**æœ€ç»ˆæ•ˆæœä¸€è‡´**ï¼Œä½†è¯­æ³•è§¦å‘çš„æ—¶æœºä¸åŒï¼ˆæ¨¡å¼åŒ¹é…æ—¶ vs è¡¨è¾¾å¼æ‰§è¡Œæ—¶ï¼‰ã€‚

3. **è¯¯åŒº3**ï¼šå‡½æ•°å‚æ•°ä¸­èƒ½ç”¨ `ref mut` æ›¿ä»£ `&mut`ï¼Ÿ

    - å¯ä»¥ï¼Œä½†ä¸æ¨èï¼ˆå¯è¯»æ€§å·®ï¼‰ï¼š

        ```Rust
        
        ```

äº”ã€æœ€ä½³å®è·µ

- å½“ä½ éœ€è¦**ä¸»åŠ¨åˆ›å»º**å¯å˜å¼•ç”¨ï¼ˆå¦‚ä¼ å‚ã€èµ‹å€¼ï¼‰ï¼šç”¨ `&mut`ï¼›

- å½“ä½ åœ¨**æ¨¡å¼åŒ¹é…**ä¸­éœ€è¦ç»‘å®šå€¼çš„å¯å˜å¼•ç”¨ï¼ˆè€Œéæ‹¿æ‰€æœ‰æƒï¼‰ï¼šç”¨ `ref mut`ï¼›

- ä¼˜å…ˆç”¨ `&mut` åšé€šç”¨çš„å¯å˜å¼•ç”¨æ“ä½œï¼Œ`ref mut` ä»…åœ¨æ¨¡å¼è§£æ„æ—¶ä½¿ç”¨ï¼ˆç¬¦åˆâ€œæœ€å°æƒŠå–œåŸåˆ™â€ï¼‰ã€‚



# rayonçš„åŸºæœ¬ç”¨æ³•

`rayon` æ˜¯ Rust ä¸­æœ€æµè¡Œçš„å¹¶è¡Œè®¡ç®—åº“ï¼Œå®ƒçš„æ ¸å¿ƒå“²å­¦æ˜¯ **â€œæ•°æ®å¹¶è¡ŒåŒ–â€ï¼ˆData Parallelismï¼‰**ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯è®©ä½ èƒ½ä»¥æå°çš„æ”¹åŠ¨ï¼Œå°†ç°æœ‰çš„è¿­ä»£å™¨ä»£ç è½¬å˜ä¸ºå¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚

ä»¥ä¸‹æ˜¯ `rayon` çš„åŸºæœ¬ç”¨æ³•å’Œæ ¸å¿ƒæ¦‚å¿µï¼š

------

### 1. æ ¸å¿ƒæ–¹æ³•ï¼š`into_par_iter()`

è¿™æ˜¯ `rayon` æœ€å¸¸ç”¨çš„æ¥å£ã€‚å®ƒèƒ½å°†ä¸€ä¸ªæ™®é€šçš„è¿­ä»£å™¨è½¬æ¢ä¸º **â€œå¹¶è¡Œè¿­ä»£å™¨â€ï¼ˆParallel Iteratorï¼‰**ã€‚

#### ä¸²è¡Œ vs å¹¶è¡Œ

Rust

```
use rayon::prelude::*; // å¿…é¡»å¼•å…¥è¿™ä¸ª Trait æ‰èƒ½ä½¿ç”¨å¹¶è¡Œæ–¹æ³•

let mut nums = vec![1, 2, 3, 4, 5, 6, 7, 8];

// ä¸²è¡Œç‰ˆæœ¬
nums.iter().map(|x| x * 2).collect::<Vec<_>>();

// å¹¶è¡Œç‰ˆæœ¬ï¼šåªéœ€æ”¹ä¸€ä¸ªè¯
nums.par_iter().map(|x| x * 2).collect::<Vec<_>>();
```

------

### 2. ä¸‰ç§ä¸»è¦çš„å¹¶è¡Œè¿­ä»£å™¨

ç±»ä¼¼äºæ ‡å‡†åº“çš„è¿­ä»£å™¨ï¼Œ`rayon` é’ˆå¯¹æ‰€æœ‰æƒæä¾›äº†ä¸‰ç§å½¢å¼ï¼š

| **æ–¹æ³•**              | **è½¬æ¢åçš„ç±»å‹** | **è¯´æ˜**                                       |
| --------------------- | ---------------- | ---------------------------------------------- |
| **`par_iter()`**      | `&T`             | äº§ç”Ÿä¸å¯å˜å¼•ç”¨çš„å¹¶è¡Œè¿­ä»£ã€‚                     |
| **`par_iter_mut()`**  | `&mut T`         | äº§ç”Ÿå¯å˜å¼•ç”¨çš„å¹¶è¡Œè¿­ä»£ï¼ˆå¸¸ç”¨äºå°±åœ°ä¿®æ”¹æ•°ç»„ï¼‰ã€‚ |
| **`into_par_iter()`** | `T`              | æ¶ˆè€—é›†åˆï¼Œäº§ç”Ÿæ‹¥æœ‰æ‰€æœ‰æƒçš„å…ƒç´ ã€‚               |

------

### 3. å¸¸ç”¨çš„å¹¶è¡Œæ“ä½œ

å¤§éƒ¨åˆ†æ ‡å‡†è¿­ä»£å™¨çš„æ–¹æ³•ï¼Œ`rayon` éƒ½æœ‰å¯¹åº”çš„å¹¶è¡Œå®ç°ï¼š

- **`filter`**: å¹¶è¡Œè¿‡æ»¤å…ƒç´ ã€‚
- **`sum / product`**: å¹¶è¡Œæ±‚å’Œæˆ–æ±‚ç§¯ã€‚
- **`reduce`**: å°†å…ƒç´ å¹¶è¡Œåˆå¹¶ä¸ºä¸€ä¸ªå€¼ï¼ˆè¦æ±‚åˆå¹¶æ“ä½œæ»¡è¶³ç»“åˆå¾‹ï¼‰ã€‚
- **`find_any`**: åªè¦ä»»ä½•ä¸€ä¸ªçº¿ç¨‹æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œå°±ç«‹å³è¿”å›ï¼ˆæ¯”ä¸²è¡Œ `find` å¿«å¾—å¤šï¼‰ã€‚

Rust

```
// ç¤ºä¾‹ï¼šå¤§è§„æ¨¡å¹¶è¡Œæ±‚å¹³æ–¹å’Œ
let sum: u64 = (0..1000_000u64)
    .into_par_iter()
    .map(|x| x * x)
    .sum();
```

------

### 4. ä»»åŠ¡åˆ‡åˆ†ï¼š`join`

å¦‚æœä½ ä¸æƒ³æ“ä½œé›†åˆï¼Œè€Œæ˜¯æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡æƒ³åŒæ—¶è·‘ï¼Œå¯ä»¥ä½¿ç”¨ `join`ã€‚å®ƒä¼šå°è¯•åœ¨åå°çº¿ç¨‹æ± ä¸­å¹¶è¡Œæ‰§è¡Œè¿™ä¸¤ä¸ªé—­åŒ…ã€‚

Rust

```
let (a, b) = rayon::join(
    || do_heavy_task_1(),
    || do_heavy_task_2()
);
```

------

### 5. å¹¶è¡ŒåŒ–çš„åº•å±‚åŸç†ï¼šå·¥ä½œçªƒå–ï¼ˆWork Stealingï¼‰

`rayon` ä¸ä¼šä¸ºæ¯ä¸ªè¿­ä»£é¡¹å¼€ä¸€ä¸ªçº¿ç¨‹ï¼ˆé‚£æ ·å¼€é”€å¤ªå¤§ï¼‰ï¼Œå®ƒç»´æŠ¤äº†ä¸€ä¸ª**å›ºå®šå¤§å°çš„çº¿ç¨‹æ± **ï¼ˆé€šå¸¸ç­‰äºä½ çš„ CPU æ ¸å¿ƒæ•°ï¼‰ã€‚

- å®ƒå°†ä»»åŠ¡åˆ‡åˆ†æˆè®¸å¤šå°å—æ”¾å…¥é˜Ÿåˆ—ã€‚
- å½“ä¸€ä¸ªçº¿ç¨‹å¹²å®Œæ´»åï¼Œå®ƒä¼šä»å…¶ä»–å¿™ç¢Œçº¿ç¨‹çš„é˜Ÿåˆ—æœ«å°¾â€œçªƒå–â€ä»»åŠ¡ã€‚
- è¿™ç§æœºåˆ¶ä¿è¯äº† CPU è´Ÿè½½çš„é«˜åº¦å‡è¡¡ï¼Œé¿å…äº†â€œä¸€æ ¸æœ‰éš¾ï¼Œå¤šæ ¸å›´è§‚â€çš„æƒ…å†µã€‚

------

### 6. ä½¿ç”¨å»ºè®®ä¸æ³¨æ„äº‹é¡¹

- è®¡ç®—å¯†é›†å‹ vs IO å¯†é›†å‹ï¼š

  rayon ä¸“é—¨ä¸º CPU è®¡ç®—å¯†é›†å‹ï¼ˆå¦‚ä½ çš„è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿã€çŸ©é˜µè¿ç®—ï¼‰ä¼˜åŒ–ã€‚å¦‚æœæ˜¯ç½‘ç»œè¯·æ±‚æˆ–ç£ç›˜è¯»å†™ç­‰ IO ä»»åŠ¡ï¼Œå»ºè®®ä½¿ç”¨ tokio ç­‰å¼‚æ­¥è¿è¡Œæ—¶ã€‚

- é¿å…å°ä»»åŠ¡è¿‡åº¦å¹¶è¡Œï¼š

  å¦‚æœè¿­ä»£å™¨é‡Œçš„é€»è¾‘æå…¶ç®€å•ï¼ˆæ¯”å¦‚åªæ˜¯ x + 1ï¼‰ï¼Œä¸”æ•°æ®é‡å¾ˆå°ï¼Œå¹¶è¡ŒåŒ–å¸¦æ¥çš„çº¿ç¨‹è°ƒåº¦å¼€é”€å¯èƒ½ä¼šæ¯”ä¸²è¡Œè¿˜æ…¢ã€‚

- çº¿ç¨‹å®‰å…¨çº¦æŸï¼š

  åœ¨ par_iter é—­åŒ…ä¸­æ•è·çš„å˜é‡å¿…é¡»å®ç° Syncï¼Œè€Œè¿­ä»£å‡ºçš„å…ƒç´ å¦‚æœè¦è·¨çº¿ç¨‹ä¼ é€’ï¼Œå¿…é¡»å®ç° Sendã€‚
