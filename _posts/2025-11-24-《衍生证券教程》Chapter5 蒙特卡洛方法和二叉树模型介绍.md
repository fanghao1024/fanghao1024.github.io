---

layout: post
title: "ã€Šè¡ç”Ÿè¯åˆ¸æ•™ç¨‹ã€‹ç¬¬äº”ç«  è’™ç‰¹å¡æ´›æ¥æ¨¡æ‹Ÿæ–¹æ³•å’ŒäºŒå‰æ ‘æ¨¡å‹ ç¬”è®°"
description: ""
author:     "Hao"
category: true
tagline: "è¡ç”Ÿå“"
tags: [finance math , derivative pricing]

---
æ ¼å¼æ›´å¥½çš„[htmlç‰ˆæœ¬](https://www.fanghao.work/2025/11/19/%E8%A1%8D%E7%94%9F%E8%AF%81%E5%88%B8%E6%95%99%E7%A8%8B-Chapter5-%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D/)
## è’™ç‰¹å¡æ´›æ–¹æ³•ä»‹ç»
æ ¹æ®é£é™©ä¸­æ€§å®šä»·å…¬å¼ï¼ˆ1.18ï¼‰ï¼Œåœ¨æ—¶é—´Tå›æŠ¥ä¸ºxçš„è¯åˆ¸çš„ä»·å€¼ä¸º
$$
	e^{-rT}\mathbb{E}^R[x] \tag{5.1}
$$
ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•ä¼°è®¡ï¼Œæ˜¯æŒ‡ç”¨æ¨¡æ‹Ÿæ–¹æ³•å¾—å‡ºéšæœºå˜é‡xçš„æ ·æœ¬å€¼ï¼Œå°†æ ·æœ¬å€¼å¹³å‡å¾—å‡ºæ•°å­¦æœŸæœ›ä¼°è®¡å€¼ã€‚
è’™ç‰¹å¡æ´›æ–¹æ³•æœ‰ä¸¤ä¸ªä¸»è¦ç¼ºé™·ï¼š
1. å¾ˆéš¾ï¼ˆå°½ç®¡ä¸æ˜¯ä¸å¯èƒ½ï¼‰ç”¨æ¥è®¡ç®—æå‰æ‰§è¡Œçš„åˆçº¦ã€‚
   å³æ— æ³•åœ¨tæ—¶åˆ»å°±æ•´åˆæ‰€æœ‰æœªæ¥è·¯å¾„çš„ä¿¡æ¯åˆ¤æ–­å½“å‰æ˜¯å¦è¡Œæƒã€‚
2. å¦‚æœç”¨è®¡ç®—æ‰€èŠ±æ—¶é—´è¡¡é‡ï¼Œè¿™ç§æ–¹æ³•æ˜¯ä½æ•ˆç‡çš„ï¼ˆå°½ç®¡è¿™ç§æ–¹æ³•åœ¨è®¡ç®—ä»¥å¤šä¸ªèµ„äº§ä¸ºæ ‡çš„è¡ç”Ÿè¯åˆ¸ä»·å€¼æ—¶ï¼Œæ¯”å…¶ä»–æ–¹æ³•çš„é€Ÿåº¦è¦å¿«ï¼‰
   è¦ä½¿å¾—ä¼°è®¡æ ‡å‡†è¯¯è¶³å¤Ÿå°ï¼Œéœ€è¦è¶³å¤Ÿå¤§çš„æ ·æœ¬é‡ï¼Œå¤§é‡çš„è®¡ç®—è¦è€—è´¹å¾ˆå¤šæ—¶é—´ã€‚è’™ç‰¹å¡æ´›æ–¹æ³•çš„å›°éš¾ä¹‹å¤„åœ¨äºå¦‚ä½•å‡å°‘æ‰€éœ€æ ·æœ¬é‡ã€‚

## äºŒå‰æ ‘æ¨¡å‹ä»‹ç»
å¯¹äºé‡å¤ç»„åˆå½¢æˆçš„æ ‘ï¼Œå½“Nå¢åŠ æ—¶ï¼Œè®¡ç®—æ—¶é—´ä»¥Nçš„çº¿æ€§å‡½æ•°å¢åŠ ï¼›è€Œå¯¹éé‡å¤ç»„åˆå½¢æˆçš„æ ‘ï¼Œè®¡ç®—æ—¶é—´ä»¥Nçš„æŒ‡æ•°å‡½æ•°å¢åŠ ã€‚é—æ†¾çš„æ˜¯ï¼Œå¯¹è·¯å¾„ä¾èµ–æœŸæƒæ¥è¯´ï¼Œè¿™ç§è®¡ç®—æ—¶é—´çš„èŠ‚çœæ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºä¸€ä¸ªæ ‘ï¼ˆä¸ç®¡æ˜¯é‡å¤ç»„åˆè¿˜æ˜¯éé‡å¤ç»„åˆçš„æ ‘ï¼‰ä¸­çš„è·¯å¾„æ•°æ˜¯$2^N$ã€‚

æ¬§å¼çœ‹æ¶¨æœŸæƒä»·å€¼çš„æ•°å­¦æœŸæœ›ç­‰äºï¼š
$$
    \sum_{i=0}^N \frac{N!}{i!(N-i)!}p^i(1-p)^{N-i}\max(u^i d^{N-i} S-K,0) \tag{5.4}
$$
å°†è¿™ä¸ªæ•°å­¦æœŸæœ›ä¹˜ä»¥$e^{-rT}$å¾—å‡ºæœŸæƒä»·å€¼ã€‚

åˆ©ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•å¯¹æ¬§å¼æœŸæƒè¿›è¡Œå®šä»·æ—¶ï¼Œç›¸å½“äºç”¨M-ç‚¹åˆ†å¸ƒæ¥è¿‘ä¼¼S(T)çš„åˆ†å¸ƒï¼Œæ¯ä¸ªç‚¹èµ‹ä»¥ç›¸ç­‰çš„æ¦‚ç‡ã€‚
äºŒå‰æ ‘æ¨¡å‹ä¸­ï¼Œé€‰å–çš„æ˜¯S(T)çš„ç‰¹å®šç‚¹çš„é›†åˆï¼Œå¹¶é‡‡ç”¨ï¼ˆ5.4ï¼‰çš„æ–¹æ³•èµ‹ä»¥å®ƒä»¬æ¦‚ç‡ï¼Œä»¥æ­¤æ¥è¿‘ä¼¼S(T)çš„åˆ†å¸ƒã€‚
å½“æ‰€é€‰å–ç‚¹çš„ä¸ªæ•°å¢åŠ æ—¶ï¼Œè’™ç‰¹å¡æ´›æ–¹æ³•å’ŒäºŒå‰æ ‘æ–¹æ³•å¾—å‡ºçš„è¿‘ä¼¼åˆ†å¸ƒéƒ½æ”¶æ•›åˆ°S(T)çš„è¿ç»­æ—¶é—´åˆ†å¸ƒã€‚ä½†æ˜¯ï¼Œç”±äºé€‰å–äº†ç‰¹æ®Šçš„ç‚¹å¹¶èµ‹ä»¥ç‰¹å®šçš„æ¦‚ç‡ï¼ŒäºŒå‰æ ‘æ–¹æ³•èƒ½å¤Ÿé‡‡ç”¨è¾ƒå°‘çš„ç‚¹è€Œå¾—å‡ºåŒæ ·ç²¾åº¦çš„è¿‘ä¼¼åˆ†å¸ƒï¼Œå³å¯¹äºç»™å®šçš„ç²¾åº¦ï¼Œç”¨è’™ç‰¹å¡æ´›æ–¹æ³•éœ€è¦Mæ¬¡æ¨¡æ‹Ÿï¼Œè€ŒäºŒå‰æ ‘æ¨¡å‹ä¸­çš„æœŸæ•°N è¦æ¯”è’™ç‰¹å¡æ´›æ–¹æ³•ä¸­çš„æ¨¡æ‹Ÿæ¬¡æ•°Må°å¾—å¤šã€‚å› æ­¤ï¼ŒäºŒå‰æ ‘æ–¹æ³•çš„è®¡ç®—é€Ÿåº¦è¦å¿«å¾ˆå¤šã€‚æ­¤å¤–ï¼Œåœ¨ç¾å¼æœŸæƒå®šä»·ä¸­ï¼Œä¸è’™ç‰¹å¡æ´›æ–¹æ³•ç›¸æ¯”ï¼ŒäºŒå‰æ ‘æ–¹æ³•æ›´å…·æœ‰ä¼˜è¶Šæ€§ã€‚
åœ¨è·¯å¾„ä»¥æ¥æœŸæƒçš„å®šä»·ä¸­ï¼Œè’™ç‰¹å¡æ´›æ–¹æ³•æ›´å¿«ã€‚åœ¨ä»¥å¤šä¸ªèµ„äº§ä¸ºæ ‡çš„çš„æœŸæƒå®šä»·ä¸­ï¼Œè’™ç‰¹å¡æ´›æ–¹æ³•è®¡ç®—é€Ÿåº¦è¦å¿«ä¸€äº›ã€‚

## ç¾å¼æœŸæƒçš„äºŒå‰æ ‘æ¨¡å‹
æœ€ä¼˜æ‰§è¡Œç­–ç•¥æ˜¯æŒ‡ï¼Œå½“æœŸæƒå†…åœ¨ä»·å€¼è¶…è¿‡æœŸæƒæœªæ¥ä»·å€¼æœŸæœ›çš„è´´ç°æ—¶æ‰§è¡ŒæœŸæƒã€‚
å› æ­¤ï¼Œæ²¿äºŒå‰æ ‘è¿›è¡Œåå‘é€’å½’æ—¶ï¼Œæ£€éªŒæ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºæœ€ä¼˜æ‰§è¡Œç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç”¨æœŸæƒå†…åœ¨ä»·å€¼ä»£æ›¿æœŸæœ›è´´ç°å€¼ã€‚
å¯¹äºç¾å¼çœ‹è·ŒæœŸæƒï¼š
$$
    P(i)=\max(K-u^i d^{n-i}S, e^{-r\Delta t}pP(i+1)+e^{-r\Delta t}(1-p)P(i)) \tag{5.9}
$$

## äºŒå‰æ ‘æ¨¡å‹çš„å‚æ•°
è€ƒè™‘é•¿åº¦ä¸ºTå¹´çš„NæœŸäºŒå‰æ ‘æ¨¡å‹ã€‚æ¯æœŸé•¿åº¦ä¸º$\Delta t=T/N$ã€‚å¯¹è¿ç»­æ—¶é—´æ¨¡å‹ï¼Œåœ¨ç¦»æ•£æ—¶é—´åŒºé—´$\Delta t$ä¸Šæœ‰
$$
    \Delta \log S =v\Delta t+\sigma \Delta B
$$
å…¶ä¸­$v=r-q-\sigma^2/2$ï¼ŒBä¸ºé£é™©ä¸­æ€§æ¦‚ç‡æµ‹åº¦ä¸‹çš„å¸ƒæœ—è¿åŠ¨ã€‚åœ¨é£é™©ä¸­æ€§æ¦‚ç‡æµ‹åº¦ä¸‹ï¼Œè¿ç»­æ¨¡å‹ä¸­$\Delta \log S$çš„å‡å€¼å’Œæ–¹å·®åˆ†åˆ«ä¸º
$$
    \mathbb{E}^R[\Delta \log S]=v\Delta t , \text{var}^R[\Delta \log S]=\sigma^2 \Delta t
$$
å› æ­¤ï¼Œ
$$
     \frac{\mathbb{E}^R[\Delta \log S]}{\Delta t}=v , \frac{\text{var}^R[\Delta \log S]}{\Delta t}=\sigma^2
$$
åœ¨äºŒå‰æ ‘æ¨¡å‹ä¸­ï¼Œ
$$
     \frac{\mathbb{E}^R[\Delta \log S]}{\Delta t}=\frac{p\log u+(1-p)\log d}{\Delta t}\\
     \frac{\text{var}^R[\Delta \log S]}{\Delta t}=\frac{p(1-p)(\log u-\log d)^2}{\Delta t}
$$
å›ºå®šæ—¶é—´æ€»é•¿åº¦Tä¸å˜ï¼Œä»¤$N\rightarrow \infty$ï¼ˆç­‰ä»·äºä»¤$\Delta t \rightarrow 0$ï¼‰ï¼ŒäºŒå‰æ ‘æ¨¡å‹åœ¨æŸç§æ„ä¹‰ä¸‹æ”¶æ•›åˆ°è¿ç»­æ—¶é—´æ¨¡å‹çš„å……åˆ†æ¡ä»¶ä¸º
$$
    \frac{p\log u +(1-p)\log d}{\Delta t}\rightarrow v\\
    \frac{p(1-p)(\log u -\log d)^2}{\Delta t}\rightarrow \sigma^2
$$
æœ€å¸¸ç”¨çš„æ¨¡å‹æ˜¯CRRï¼Œå³å–d=1/uï¼Œå¹¶ä¸”
$$ u = \mathrm{e}^{\sigma \sqrt{\Delta t}} \tag{5.10a} $$

$$ p = \frac{\mathrm{e}^{(r-q) \Delta t} - d}{u - d} \tag{5.10b} $$
å¦ä¸€ä¸ªå¾ˆæœ‰åçš„æ¨¡å‹æ˜¯å–p=1/2ï¼Œå¹¶ä¸”
$$ u = \exp\left(\left(r - q - \frac{1}{2}\sigma^{2}\right)\Delta t + \sigma\sqrt{\Delta t}\right) \tag{5.11a} $$

$$ d = \exp\left(\left(r - q - \frac{1}{2}\sigma^{2}\right)\Delta t - \sigma\sqrt{\Delta t}\right) \tag{5.11b} $$

Trigeorgisæå‡ºï¼Œpã€uå’Œdçš„é€‰æ‹©åº”è¯¥ä½¿äºŒå‰æ ‘æ¨¡å‹ä¸­$\Delta \log S$çš„å‡å€¼å’Œæ–¹å·®ä¸è¿ç»­æ¨¡å‹ä¸­çš„å‡å€¼å’Œæ–¹å·®å®Œå…¨ç›¸ç­‰ï¼Œå³
$$ \frac{p\log u+(1-p)\log d}{\Delta t}=\nu \tag{1} $$

$$ \frac{p(1-p)(\log u-\log d)^{2}}{\Delta t}=\sigma^{2} \tag{2} $$
ä¸¤ä¸ªæ–¹ç¨‹æœ‰ä¸‰ä¸ªæœªçŸ¥æ•°ï¼Œå–d=1/uï¼Œå¯å¾—
$$ \log u = \sqrt{\sigma^{2}\Delta t + \nu^{2}(\Delta t)^{2}} \tag{5.13a} $$

$$ p = \frac{1}{2} + \frac{\nu\Delta t}{2\log u} \tag{5.13b} $$

## äºŒå‰æ ‘æ¨¡å‹ä¸­çš„å¸Œè…Šå­—æ¯
å¯¹ä»»ä½•å®šä»·æ¨¡å‹æ¥è¯´ï¼Œè¦ä¼°è®¡å¸Œè…Šå­—æ¯çš„å€¼ï¼Œåªéœ€ç”¨ä¸åŒçš„å‚æ•°å€¼è¿è¡Œä¸¤æ¬¡å®šä»·ç¨‹åºï¼Œç„¶åç”¨ä¸¤ä¸ªå®šä»·ä¹‹å·®é™¤ä»¥å‚æ•°å€¼çš„å·®ã€‚
ä»ç†è®ºä¸Šæ¥è¯´ï¼Œå‚æ•°å˜åŒ–é‡è¶Šå°ï¼Œä¼°è®¡å‡ºæ¥çš„å¸Œè…Šå­—æ¯è¶Šç²¾ç¡®ï¼Œä½†åœ¨å®é™…è®¡ç®—ä¸­ï¼Œè®¡ç®—æœºå››èˆäº”å…¥å¸¦æ¥çš„è¯¯å·®ä¼šé™åˆ¶é‡‡ç”¨è¿‡å°çš„å‚æ•°å˜åŒ–é‡ã€‚
$$
    \delta=\frac{C_u-C_d}{S_u-S_d} \tag{5.14}
$$

$$
    \Gamma=\frac{\delta_u-\delta_d}{(S_u-S_d)/2} \tag{5.15}
$$
åœ¨äºŒå‰æ ‘æ¨¡å‹ä¸­ï¼Œå¯ä»¥é€šè¿‡æ›´ä¸ºæœ‰æ•ˆçš„æ–¹æ³•å¯¹ä¸¤ä¸ªæœ€é‡è¦çš„å¸Œè…Šå­—æ¯$\delta$å’Œ$\gamma$è¿›è¡Œä¼°è®¡ï¼Œè€Œä¸å¿…é‡‡ç”¨å¤šæ¬¡è¿è¡Œå®šä»·ç¨‹åºçš„æ–¹æ³•ã€‚
å¦‚åœ¨ï¼ˆ5.14ï¼‰å’Œï¼ˆ5.15ï¼‰ä¸­å–$S_u=u^2S$å’Œ$S_d=d^2S$

## è’™ç‰¹å¡æ´›æ–¹æ³•ä¸­çš„å¸Œè…Šå­—æ¯Iï¼šå·®å€¼æ¯”
ä¸ºäº†å°½é‡å‡å°‘è®¡ç®—è¯¯å·®å’Œè®¡ç®—æ¬¡æ•°ï¼Œåœ¨è®¡ç®—ä¸åŒå‚æ•°ä¸‹çš„è¡ç”Ÿè¯åˆ¸ä»·å€¼æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ç›¸åŒçš„éšæœºæŠ½æ ·ã€‚
>$$
>Var(X-Y)=Var(X)+Var(Y)-2Cov(X,Y)
>$$
>é‡‡ç”¨ç›¸åŒçš„æŠ½æ ·ï¼Œå¯ä»¥è®©Cov(X,Y)ä¸º0,å‡å°‘æ–¹å·®
åœ¨BSå‡è®¾ä¸‹ï¼Œåªéœ€è¦äº§ç”Ÿå‡ºS(T)å°±å¯ä»¥é‡‡ç”¨$[S_u(0)/S(0)]\times S(T)$è®¡ç®—å‡º$S_u(T)$ï¼Œ$S_d(T)$åŒç†ï¼Œç„¶åé‡‡ç”¨ä¸è®¡ç®—è¡ç”Ÿè¯åˆ¸ä»·å€¼æ ‡å‡†è¯¯ç›¸åŒçš„æ–¹æ³•å¯ä»¥è®¡ç®—å¸Œè…Šå­—æ¯å€¼çš„æ ‡å‡†è¯¯ã€‚
**èµ„äº§ä»·æ ¼å¯¹æ•°è¿‡ç¨‹ï¼š**
$$
\begin{aligned}
\log S_d(T) &= \log S_d + \left(r - q - \frac{1}{2}\sigma^2\right) T + \sigma B(T) \\
\log S(T) &= \log S + \left(r - q - \frac{1}{2}\sigma^2\right) T + \sigma B(T) \\
\log S_u(T) &= \log S_u + \left(r - q - \frac{1}{2}\sigma^2\right) T + \sigma B(T)
\end{aligned}
$$

**æ¨å¯¼ç»“æœï¼š**
$$
\begin{aligned}
S_d(T) &= \left(\frac{S_d}{S}\right) S(T) \\
S_u(T) &= \left(\frac{S_u}{S}\right) S(T)
\end{aligned}
$$
å› æ­¤ï¼Œåœ¨BSå‡è®¾ä¸‹ï¼Œåªéœ€è¦æ¨¡æ‹ŸS(T)çš„å€¼ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢çš„å…¬å¼ç›¸ä¹˜å¾—å‡º$S_d(T)$å’Œ$S_u(T)$
ä»¥ä¸Šæ–¹æ³•é€‚åˆå¯¹äºæ— è·¯å¾„ä¾èµ–çš„è¡ç”Ÿè¯åˆ¸ã€‚
å¯¹äºæ›´ä¸€èˆ¬çš„æ¬§å¼è¡ç”Ÿè¯åˆ¸ï¼š
+ $\delta$
  å·®å€¼$(C_u(T)-C_d(T))çš„æ ·æœ¬å‡å€¼ä¹˜ä»¥$e^{-rT}/(S_u-S_d)$ã€‚
  æ ‡å‡†è¯¯=
  $$
      \frac{\mathrm{e}^{-rT}}{S_u - S_d} \sqrt{ \frac{1}{M(M-1)} \left( \sum_{i=1}^M \left[ C_{ui}(T) - C_{di}(T) \right]^2 - M \left[ \overline{C_u(T)} - \overline{C_d(T)} \right]^2 \right) }
  $$
  æ ‡å‡†è¯¯ä¸º$\frac{s}{\sqrt{M}}$ï¼Œè€Œ$s^2=\frac{1}{M-1}\sum_{i=1}^M[x_i-\bar{x}]^2=\frac{1}{M-1}(\sum_{i=1}^M x_i^2-M\bar{X}^2)$
+ $\gamma$
  ä¼½ç›çš„è’™ç‰¹å¡æ´›ä¼°è®¡ä¹Ÿæ˜¯ä¸€ä¸ªæ ·æœ¬å‡å€¼ï¼š
  $$
  \Gamma = \frac{2}{(S_u - S)(S_u - S_d)} C_u - \frac{2}{(S_u - S)(S - S_d)} C + \frac{2}{(S - S_d)(S_u - S_d)} C_d \tag{5.16}
  $$
  é€šå¸¸æƒ…å†µä¸‹å–$S_u=(1+\alpha)S,S_d=(1-\alpha)S$ï¼Œ$\alpha$ä¸ºæŸä¸ªå¸¸æ•°ã€‚æ­¤æ—¶ï¼Œ(5.16)ä¸º
  $$
      \Gamma=\frac{C_u-2C+C_d}{\alpha^2 S^2} \tag{5.17}
  $$
  è€Œä¼½ç›çš„æ ‡å‡†è¯¯ä¸º
  $$
  \frac{\mathrm{e}^{-rT}}{\alpha^2 S^2} \sqrt{\frac{1}{M(M - 1)}} \times \sqrt{\sum_{i=1}^M \left[ C_{ui}(T) - 2C_i(T) + C_{di}(T) \right]^2 - M \left[ \overline{C_u}(T) - 2\overline{C}(T) + \overline{C_d}(T) \right]^2}

  $$

## è’™ç‰¹å¡æ´›æ–¹æ³•ä¸­çš„å¸Œè…Šå­—æ¯IIï¼šæŒ‰è·¯å¾„ä¼°è®¡
å‚æ•°ä¼°è®¡æ˜¯â€œæœ‰åçš„â€ï¼Œæ˜¯æŒ‡ä¼°è®¡é‡æœŸæœ›å€¼ä¸ç­‰äºå‚æ•°çœŸå€¼ã€‚æ³¨æ„ï¼Œå¦‚æœè’™ç‰¹å¡æ´›ä¼°è®¡å€¼æ˜¯æœ‰åçš„ï¼Œå³ä½¿æ¨¡æ‹Ÿæ¬¡æ•°å¾ˆå¤šã€æ ‡å‡†è¯¯å¾ˆæ¥è¿‘0,è’™ç‰¹å¡æ´›æ–¹æ³•ç»™å‡ºçš„ç»“è®ºä¹Ÿæ˜¯ä¸æ­£ç¡®çš„ã€‚
è¯¥èŠ‚é˜è¿°äº†åœ¨æœŸæƒå®šä»·ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•è®¡ç®—å¸Œè…Šå€¼â€œDeltaâ€ï¼Œå¹¶é‡ç‚¹åˆ†æäº†ä¼ ç»Ÿâ€œæœ‰é™å·®åˆ†æ³•â€å­˜åœ¨çš„**åå·®**é—®é¢˜ï¼Œä»¥åŠæ›´ä¼˜çš„â€œè·¯å¾„æ³•â€ä¼°è®¡åŸç†ã€‚

### æ ¸å¿ƒä¸»é¢˜ï¼šè’™ç‰¹å¡æ´›æ–¹æ³•è®¡ç®— Delta çš„ä¸¤ç§æ–¹å¼åŠå…¶åå·®

æ•´ä¸ªè®¨è®ºçš„èƒŒæ™¯æ˜¯ï¼šæˆ‘ä»¬æ— æ³•ç”¨å…¬å¼ç›´æ¥è®¡ç®—æœŸæƒä»·æ ¼å¯¹æ ‡çš„èµ„äº§ä»·æ ¼ï¼ˆSï¼‰çš„æ•æ„Ÿåº¦ï¼ˆDeltaï¼‰æ—¶ï¼Œä¼šé‡‡ç”¨è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼Œé€šè¿‡ç”Ÿæˆå¤§é‡èµ„äº§ä»·æ ¼çš„æœªæ¥è·¯å¾„æ¥ä¼°ç®—ã€‚å…³é”®é—®é¢˜åœ¨äºå¦‚ä½•ä»æ¨¡æ‹Ÿçš„è·¯å¾„ä¸­è®¡ç®—å‡ºå‡†ç¡®çš„ Deltaã€‚

---

### ç¬¬ä¸€éƒ¨åˆ†ï¼šä¼ ç»Ÿæ–¹æ³•â€”â€”â€œæœ‰é™å·®åˆ†æ³•â€åŠå…¶é—®é¢˜

#### 1. æ–¹æ³•æè¿°
è¿™ç§æ–¹æ³•å¾ˆç›´è§‚ï¼Œç±»ä¼¼äºæ•°å€¼æ±‚å¯¼ï¼š
1.  è®¾å®šä¸€ä¸ªåˆå§‹æ ‡çš„ä»·æ ¼ `S`ã€‚
2.  å¯¹åŸå§‹ä»·æ ¼ `S` è¿›è¡Œä¸€ä¸ªå¾®å°çš„æ‰°åŠ¨ï¼Œå¾—åˆ°ä¸¤ä¸ªæ–°ä»·æ ¼ï¼š`S_u`ï¼ˆå‘ä¸Šæ‰°åŠ¨ï¼‰å’Œ `S_d`ï¼ˆå‘ä¸‹æ‰°åŠ¨ï¼‰ã€‚
3.  åˆ†åˆ«åŸºäº `S`, `S_u`, `S_d` è¿›è¡Œè’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼Œè®¡ç®—å¯¹åº”çš„æœŸæƒåˆ°æœŸä»·å€¼ `C(T)`, `C_u(T)`, `C_d(T)`ã€‚
4.  Delta çš„ä¼°è®¡å€¼å°±æ˜¯æŠ˜æ‰£åçš„æ ·æœ¬å‡å€¼ï¼š
$$\frac{C_{u}(T-C_{d}(T)}{S_{u}-S_{d}} \tag{5.18}$$

#### 2. åå·®çš„æ¥æº
æ–‡æœ¬é€šè¿‡åˆ†ææœŸæƒåˆ°æœŸæ—¶çš„ä¸‰ç§çŠ¶æ€ï¼Œæ­ç¤ºäº†è¿™ç§ä¼°è®¡æ–¹æ³•å­˜åœ¨**åå·®**ï¼Œå³ä¼°è®¡å€¼çš„æœŸæœ›ä¸ç­‰äºçœŸå®çš„ Deltaã€‚

*   **æƒ…å†µä¸€ï¼šæ·±åº¦è™šå€¼**
    *   æ¡ä»¶ï¼š $S_u(T) â‰¤ K$ ï¼ˆå³å³ä½¿ä»·æ ¼å‘ä¸Šæ‰°åŠ¨ï¼Œåˆ°æœŸæ—¶æœŸæƒä»æ— ä»·å€¼ï¼‰
    *   ç»“æœï¼š $C_u(T) = C_d(T) = 0$ï¼Œå› æ­¤æ¯”å€¼ (5.18) ä¸º **0**ã€‚

*   **æƒ…å†µäºŒï¼šæ·±åº¦å®å€¼**
    *   æ¡ä»¶ï¼š $S_d(T) â‰¥ K$ ï¼ˆå³å³ä½¿ä»·æ ¼å‘ä¸‹æ‰°åŠ¨ï¼Œåˆ°æœŸæ—¶æœŸæƒä»ä¸ºå®å€¼ï¼‰
    *   ç»“æœï¼š $C_u(T) = S_u(T) - K$ï¼Œ$C_d(T) = S_d(T) - K$ã€‚æ­¤æ—¶æ¯”å€¼ (5.18) æ°å¥½ç­‰äº **S(T)/S**ã€‚

*   **æƒ…å†µä¸‰ï¼šä¸´ç•ŒçŠ¶æ€ï¼ˆåå·®æ ¹æºï¼‰**
    *   æ¡ä»¶ï¼š $S_u(T) > K > S_d(T)$ ï¼ˆå³æœªæ‰°åŠ¨æ—¶ï¼ŒæœŸæƒå¯èƒ½åœ¨è™šå€¼å’Œå®å€¼ä¹‹é—´ï¼‰
    *   ç»“æœï¼šåªæœ‰ $C_u(T)$ æœ‰ä»·å€¼ï¼Œ$C_d(T) = 0$ã€‚æ­¤æ—¶æ¯”å€¼ (5.18) æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œä¸”**å°äº** `S(T)/S`ã€‚

**æ ¸å¿ƒé—®é¢˜**ï¼šçœŸå®çš„ Delta åœ¨æ•°å­¦ä¸Šç­‰äºå¯¹ä»¥ä¸‹å¯¼æ•°æ±‚æœŸæœ›ï¼š
$$\frac{\partial{\max(0,S(T-K))}}{{\partial{S}}}$$
è¿™ä¸ªå¯¼æ•°éå¸¸ç®€å•ï¼š
*   è‹¥ $S(T) > K$ï¼Œå¯¼æ•°ä¸º $S(T)/S$ã€‚
*   è‹¥ $S(T) < K$ï¼Œå¯¼æ•°ä¸º `0`ã€‚

è€Œâ€œæœ‰é™å·®åˆ†æ³•â€çš„ä¼°è®¡é‡ (5.18) åœ¨ä¸´ç•ŒçŠ¶æ€ï¼ˆæƒ…å†µä¸‰ï¼‰ä¸‹çš„è¡Œä¸ºä¸çœŸå®çš„å¯¼æ•°**ä¸ä¸€è‡´**ï¼Œå¯¼è‡´å…¶æœŸæœ›å€¼ï¼ˆå…¬å¼5.22ï¼‰ä¸çœŸå®Deltaçš„æœŸæœ›å€¼ï¼ˆå…¬å¼5.21ï¼‰ä¸åŒã€‚è¿™å°±äº§ç”Ÿäº†**åå·®**ã€‚

**åå·®çš„ä¸¥é‡åæœ**ï¼šå³ä½¿è¿›è¡Œæ— é™æ¬¡æ¨¡æ‹Ÿï¼Œå°†æ ‡å‡†è¯¯å·®é™ä¸ºé›¶ï¼Œè¿™ä¸ªä¼°è®¡å€¼ä¹Ÿä¼šç³»ç»Ÿåœ°åç¦»çœŸå®å€¼ï¼Œç»™å‡ºé”™è¯¯çš„ç­”æ¡ˆã€‚

---

### ç¬¬äºŒéƒ¨åˆ†ï¼šè§£å†³æ–¹æ¡ˆâ€”â€”â€œè·¯å¾„æ³•â€ä¼°è®¡

æ—¢ç„¶çŸ¥é“äº†é—®é¢˜æ‰€åœ¨ï¼Œä¸€ä¸ªæ›´ä¼˜çš„æ–¹æ¡ˆè¢«æå‡ºï¼š**è·¯å¾„æ³•**ã€‚

#### 1. æ–¹æ³•æè¿°
è¿™ç§æ–¹æ³•ç›´æ¥ã€é«˜æ•ˆï¼Œå®Œå…¨é¿å…äº†æœ‰é™å·®åˆ†æ³•çš„é—®é¢˜ã€‚
1.  ç›´æ¥åŸºäºåˆå§‹ä»·æ ¼ `S` ç”Ÿæˆæ ·æœ¬è·¯å¾„ã€‚
2.  å¯¹äºæ¯ä¸€æ¡è·¯å¾„ï¼Œå¦‚æœæœŸæƒåˆ°æœŸæ—¶æ˜¯å®å€¼çš„ï¼ˆå³ `S(T) > K`ï¼‰ï¼Œåˆ™ç›´æ¥è®¡ç®—è¯¥è·¯å¾„å¯¹ Delta çš„è´¡çŒ®ä¸º `S(T)/S`ï¼›å¦‚æœæ˜¯è™šå€¼çš„ï¼Œè´¡çŒ®ä¸º `0`ã€‚
3.  Delta çš„ä¼°è®¡å€¼å°±æ˜¯æ‰€æœ‰è¿™äº›è´¡çŒ®å€¼çš„æŠ˜æ‰£æ ·æœ¬å¹³å‡ã€‚
4.  ç”¨æ•°å­¦å…¬å¼è¡¨ç¤ºï¼Œå°±æ˜¯ç›´æ¥ä¼°è®¡çœŸå®çš„ Deltaï¼ˆå…¬å¼5.21ï¼‰ï¼š
  $e^{-rT}E^{R}\left[\frac{S(T}{S}\mathbf{1}_{S(T)>K}\right])$
    å…¶ä¸­ `ğŸ™` æ˜¯æŒ‡ç¤ºå‡½æ•°ï¼Œå½“ `S(T) > K` æ—¶ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚

#### 2. è·¯å¾„æ³•çš„ä¼˜åŠ¿
*   **æ— åæ€§**ï¼šå› ä¸ºå®ƒç›´æ¥ä¼°è®¡äº†çœŸå®çš„ Delta è¡¨è¾¾å¼ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ— åä¼°è®¡ã€‚
*   **æ•ˆç‡é«˜**ï¼šåªéœ€è¦å¯¹åŸå§‹è·¯å¾„è¿›è¡Œæ¨¡æ‹Ÿï¼Œæ— éœ€åƒæœ‰é™å·®åˆ†æ³•é‚£æ ·å¯¹æ¯æ¡è·¯å¾„åšä¸¤æ¬¡æ‰°åŠ¨æ¨¡æ‹Ÿï¼Œè®¡ç®—æˆæœ¬æ›´ä½ã€‚
*   **æ ‡å‡†è¯¯å·®å¯è®¡ç®—**ï¼šå…¶ç»“æœæ˜¯ä¸€ä¸ªç®€å•çš„æ ·æœ¬å¹³å‡å€¼ï¼Œå› æ­¤å…¶æ ‡å‡†è¯¯å·®å¯ä»¥åƒå¸¸è§„è’™ç‰¹å¡æ´›ä¼°è®¡ä¸€æ ·æ–¹ä¾¿åœ°è®¡ç®—ã€‚

### æ€»ç»“

| ç‰¹æ€§ | æœ‰é™å·®åˆ†æ³• | è·¯å¾„æ³• |
| :--- | :--- | :--- |
| **æ ¸å¿ƒæ€æƒ³** | é€šè¿‡æ‰°åŠ¨åˆå§‹ä»·æ ¼ï¼Œæ¨¡æ‹Ÿâ€œä¸Š/ä¸‹â€ä¸¤æ¡è·¯å¾„ï¼Œç”¨å·®åˆ†è¿‘ä¼¼å¯¼æ•°ã€‚ | ç›´æ¥å¯¹æ¯æ¡è·¯å¾„è®¡ç®—å…¶æ”¯ä»˜å‡½æ•°å…³äºæ ‡çš„ä»·æ ¼çš„**è§£æå¯¼æ•°**ã€‚ |
| **æ˜¯å¦å­˜åœ¨åå·®** | **æ˜¯**ï¼Œåœ¨æœŸæƒä»·å€¼ä¸´ç•Œç‚¹å¤„è¡Œä¸ºä¸çœŸå®å¯¼æ•°ä¸ç¬¦ã€‚ | **å¦**ï¼Œç›´æ¥ä¼°è®¡çœŸå®å¯¼æ•°çš„æœŸæœ›ã€‚ |
| **è®¡ç®—æ•ˆç‡** | è¾ƒä½ï¼Œæ¯ä»½æœŸæƒéœ€æ¨¡æ‹Ÿä¸‰æ¬¡ï¼ˆåŸå§‹ã€ä¸Šã€ä¸‹ï¼‰ã€‚ | è¾ƒé«˜ï¼Œæ¯ä»½æœŸæƒåªéœ€æ¨¡æ‹Ÿä¸€æ¬¡ã€‚ |
| **å‡†ç¡®æ€§** | å³ä½¿æ¨¡æ‹Ÿæ¬¡æ•°æ— é™ï¼Œç»“æœä¹Ÿå¯èƒ½ä¸æ­£ç¡®ã€‚ | éšç€æ¨¡æ‹Ÿæ¬¡æ•°å¢åŠ ï¼Œç»“æœæ”¶æ•›äºçœŸå®å€¼ã€‚ |

å› æ­¤ï¼Œåœ¨å¯ä»¥ä½¿ç”¨è·¯å¾„æ³•çš„æƒ…å½¢ä¸‹ï¼ˆå³æ”¯ä»˜å‡½æ•°å…³äºæ ‡çš„ä»·æ ¼çš„å¯¼æ•°å­˜åœ¨ä¸”å¯æ±‚ï¼‰ï¼Œå®ƒé€šå¸¸æ˜¯è®¡ç®—å¸Œè…Šå€¼çš„æ›´ä¼˜é€‰æ‹©ã€‚è¿™ç§æ–¹æ³•ç”± Broadie å’Œ Glasserman æå‡ºï¼Œå¹¶å¯ä»¥æ‰©å±•åˆ°å…¶ä»–å¸Œè…Šå€¼ï¼ˆå¦‚ Gamma, Vegaç­‰ï¼‰å’Œå…¶ä»–æ›´å¤æ‚çš„æ¨¡å‹ã€‚

## å®ç°
### æ¬§å¼çœ‹æ¶¨æœŸæƒçš„è’™ç‰¹å¡æ´›å®šä»·
æœŸæƒä»·æ ¼$e^{-rT}\mathbb{E}^R[x]$
å·®å€¼æ¯”æ–¹æ³•è®¡ç®—çš„å¾·å°”å¡”$e^{-rT}\frac{\bar{C_u(T)-C_d(T)}}{S_u-S_d}$
æŒ‰è·¯å¾„è®¡ç®—çš„å¾·å°”å¡”$e^{-rT}\mathbb{E}[\frac{S(T)}{S}x]$

```rust
use rand::Rng;
    use rand_distr::StandardNormal;
    pub fn European_Call_MC(S:f64,K:f64,r:f64,sigma:f64,q:f64,T:f64,M:usize)->(f64,f64,f64){
        let LogS0=S.ln();
        let drift=(r-q-0.5*sigma.powi(2))*T;
        let SigSqrtT=sigma*T.sqrt();
        let UpChange:f64=(1.01_f64).ln();
        let DownChange:f64=(0.99_f64).ln();
        let mut SumCall=0.0;
        let mut SumCallChange=0.0;
        let mut SumPathwise=0.0;
        let mut rng=rand::rng();
        for i in 0..M{
            let rand_increment:f64=rng.sample(rand_distr::StandardNormal);
            let LogS:f64=LogS0+drift+SigSqrtT*rand_increment; //log S(T)çš„æ¨¡æ‹Ÿå€¼
            let CallV:f64=(LogS.exp()-K).max(0.0); //æœŸæƒä»·å€¼
            SumCall+=CallV; //æœŸæƒä»·å€¼æ±‚å’Œ
            let LogSu=LogS+UpChange; //log S_u(T)çš„æ¨¡æ‹Ÿå€¼
            let CallVu:f64=(LogSu.exp()-K).max(0.0); //æœŸæƒä»·å€¼
            let LogSd=LogS+DownChange; //log S_d(T)çš„æ¨¡æ‹Ÿå€¼
            let CallVd:f64=(LogSd.exp()-K).max(0.0); //æœŸæƒä»·å€¼
            SumCallChange+=CallVu-CallVd;  //æœŸæƒä»·å€¼ä¹‹å·®
            if LogS.exp()>K{
                SumPathwise+=LogS.exp()/S;  //è·¯å¾„æ±‚å’Œ
            }
        }
        let CallV:f64=(-r*T).exp()*SumCall/M as f64;
        let Delta1:f64=(-r*T).exp()*SumCallChange/(M as f64*0.02*S);
        let Delta2:f64=(-r*T).exp()*SumPathwise/M as f64;
        (CallV,Delta1,Delta2)
    }
```

### GARCHæ¨¡å‹çš„è’™ç‰¹å¡æ´›å®šä»·
```rust
    pub fn European_Call_GARCH_MC(S:f64,K:f64,r:f64,sigma0:f64,q:f64,T:f64,N:usize,kappa:f64,theta:f64,lambda:f64,M:usize)->(f64,f64){
        //è¾“å…¥å‚æ•°ï¼š
        //S:è‚¡ç¥¨åˆå§‹ä»·æ ¼
        //K:æ‰§è¡Œä»·æ ¼
        //sigma0:åˆå§‹æ³¢åŠ¨ç‡
        //q:çº¢åˆ©æ”¯ä»˜ç‡
        //T:åˆ°æœŸæ—¶é—´
        //N:æ—¶é—´åŒºé—´æ•°
        //kappaã€thetaã€lambda:GARCHå‚æ•°
        //M:æ¨¡æ‹Ÿæ¬¡æ•°
        let deltaT:f64=T/N as f64;
        let sqrtT:f64=deltaT.sqrt();
        let a=kappa*theta;
        let b:f64=(1.0-kappa)*lambda;
        let c:f64=(1.0-kappa)*(1.0-lambda);
        let LogS0=S.ln();
        let mut SumCall=0.0;
        let mut SumCallSq=0.0;
        let mut rng=rand::rng();
        for i in 0..M{
            let mut LogS=LogS0;
            let mut Sigma=sigma0;
            for j in 0..N{
                let rand_increment:f64=rng.sample(rand_distr::StandardNormal);
                let y:f64=Sigma*rand_increment;
                LogS+=(r-q-0.5*Sigma.powi(2))*deltaT+sqrtT*y;
                Sigma=(a+b*y.powi(2)+c*Sigma.powi(2)).sqrt(); //æ›´æ–°æ³¢åŠ¨ç‡
            }
            let CallV:f64=(LogS.exp()-K).max(0.0);
            SumCall+=CallV;
            SumCallSq+=CallV.powi(2);
        }
        let CallV=(-r*T).exp()*SumCall/M as f64;
        let StdError=(-r*T).exp()*((SumCallSq-SumCall.powi(2)/M as f64)/(M*(M-1)) as f64).sqrt();
        (CallV,StdError)
    }
```

å…¶ä¸­æ ‡å‡†è¯¯çš„è®¡ç®—å…¬å¼æ˜¯ï¼š
$$
\sqrt{\frac{1}{N(N-1)}(\sum_{i=1}^{N}x_i^2-N\bar{x}^2)}
$$
### æ¬§å¼æœŸæƒçš„äºŒå‰æ ‘å®šä»·
```rust
 pub fn Europea_Call_Binomial(S:f64,K:f64,r:f64,sigma:f64,q:f64,T:f64,N:usize)->f64{
        let dt=T/N as f64; //æ—¶é—´åŒºé—´é•¿åº¦
        let u=(sigma*dt.sqrt()).exp(); //ä¸Šå‡æ­¥é•¿
        let d=1.0/u; //ä¸‹é™æ­¥é•¿
        let pu=(((r-q)*dt).exp()-d)/(u-d); //ä¸Šå‡æ¦‚ç‡
        let pd=1.0-pu;  //ä¸‹é™æ¦‚ç‡
        let u2=u*u;

        //è®¡ç®—åº•éƒ¨èŠ‚ç‚¹ï¼ˆå³æ¯æ¬¡éƒ½ä¸‹é™è¾¾åˆ°çš„èŠ‚ç‚¹ï¼‰å¤„çš„è‚¡ç¥¨ä»·æ ¼ã€åˆ°è¾¾è¯¥èŠ‚ç‚¹çš„æ¦‚ç‡ä»¥åŠå…¬å¼(5.4)ä¸­çš„ç¬¬ä¸€é¡¹
        let mut S=S*d.powi(N as i32);
        let mut prob=pd.powi(N as i32);
        let mut CallV=prob*(S-K).max(0.0);
        for i in 1..=N{
            S*=u2;
            prob*=(pu/pd)*(N-i+1) as f64/i as f64;
            CallV+=prob*(S-K).max(0.0);
        }
        (-r*T).exp()*CallV

    }
```

ä¸Šé¢ä»£ç ä¸­å…³äºiæ¬¡ä¸Šå‡çš„æ¦‚ç‡å’Œi-1æ¬¡ä¸Šå‡çš„æ¦‚ç‡ä¹‹æ¯”ä¸ºï¼š
$$
\frac{p^i(1-p)^{N-i}N!/i!(N-i)!}{p^{i-1}(1-p)^{N-i+1}N!/(i-1)!(N-i+1)!}=\frac{(N-i+1)p}{(1-p)i}
$$
### ç¾å¼æœŸæƒçš„äºŒå‰æ ‘å®šä»·
```rust
pub fn American_Put_Binomial(S0:f64,K:f64,r:f64,sigma:f64,q:f64,T:f64,N:usize)->f64{
        //è¾“å…¥å‚æ•°ä¸º
        //S0:åˆå§‹è‚¡ç¥¨ä»·æ ¼
        //K:æ‰§è¡Œä»·æ ¼
        //r:æ— é£é™©åˆ©ç‡
        //sigma:æ³¢åŠ¨ç‡
        //q:çº¢åˆ©æ”¯ä»˜ç‡
        //T:åˆ°æœŸæ—¶é—´
        //N:æ—¶é—´åŒºé—´ä¸ªæ•°
        let dt=T/N as f64;  //æ—¶é—´åŒºé—´é•¿åº¦
        let u=(sigma*dt.sqrt()).exp();  //ä¸Šå‡æ­¥é•¿
        let d=1.0/u;  //ä¸‹é™æ­¥é•¿
        let pu=(((r-q)*dt).exp()-d)/(u-d); //ä¸Šå‡æ¦‚ç‡
        let pd=1.0-pu;  //ä¸‹é™æ¦‚ç‡
        let discount=(-r*dt).exp();
        let dpu=discount*pu; //è´´ç°ä¸Šå‡æ¦‚ç‡
        let dpd:f64=discount*pd; //è´´ç°ä¸‹è·Œæ¦‚ç‡
        let u2=u*u;

        let mut S=S0*d.powi(N as i32); //åº•éƒ¨èŠ‚ç‚¹çš„è‚¡ç¥¨ä»·æ ¼
        let mut PutV=vec![0.0;N+1];
        PutV[0]=(K-S).max(0.0); //åº•éƒ¨èŠ‚ç‚¹çœ‹è·ŒæœŸæƒä»·å€¼
        for i in 1..=N{
            S*=u2;
            PutV[i]=(K-S).max(0.0);
        }

        for i in (0..N).rev(){ //æ²¿æ—¶é—´å€’å›åˆ°0æ—¶
            let mut S_cur=S0*d.powi(i as i32);  //åº•éƒ¨èŠ‚ç‚¹çš„è‚¡ç¥¨ä»·æ ¼
            PutV[0]=(K-S_cur).max(dpd*PutV[0]+dpu*PutV[1]);
            for j in 1..=i{
                S_cur*=u2;
                PutV[j]=(K-S_cur).max(dpd*PutV[j]+dpu*PutV[j+1]);
            }
        }
        PutV[0]

    }
```
### å¾·å°”å¡”å’Œä¼½ç›çš„äºŒå‰æ ‘ä¼°è®¡
```rust
pub fn American_Put_Binomial_Delta_Gamma(S0:f64,K:f64,r:f64,sigma:f64,q:f64,T:f64,N:usize)->(f64,f64,f64){
        //è¾“å…¥å‚æ•°ä¸º
        //S0:åˆå§‹è‚¡ç¥¨ä»·æ ¼
        //K:æ‰§è¡Œä»·æ ¼
        //r:æ— é£é™©åˆ©ç‡
        //sigma:æ³¢åŠ¨ç‡
        //q:çº¢åˆ©æ”¯ä»˜ç‡
        //T:åˆ°æœŸæ—¶é—´
        //N:æ—¶é—´åŒºé—´ä¸ªæ•°
        //è¿”å›(put value,delta,gamma)
        let dt=T/N as f64;
        let NewN=N+2;
        let u=(sigma*dt.sqrt()).exp();
        let d=1.0/u;
        let pu=(((r-q)*dt).exp()-d)/(u-d);
        let pd=1.0-pu;
        let dpu=(-r*dt).exp()*pu;
        let dpd=(-r*dt).exp()*pd;
        let u2=u*u;

        let mut S=S0*d.powi(NewN as i32);
        let mut PutV=vec![0.0;NewN+1];

        let mut S=S0*d.powi(NewN as i32);
        PutV[0]=(K-S).max(0.0);
        for i in (2..=NewN-1).rev(){
            let mut S_cur=S0*d.powi(i as i32);
            PutV[0]=(K-S_cur).max(dpd*PutV[0]+dpu*PutV[1]);
            for j in 1..=i{
                S_cur*=u2;
                PutV[j]=(K-S_cur).max(dpd*PutV[j]+dpu*PutV[j+1]);
            }
        }
        let Su=S0*u2;  //é«˜è‚¡ç¥¨ä»·æ ¼
        let Sd=S0/u2;  //ä½è‚¡ç¥¨ä»·æ ¼

        let DeltaU=(PutV[2]-PutV[1])/(Su-S0); //ä¸Šä¸­ç‚¹å¾·å°”å¡”
        let DeltaD=(PutV[1]-PutV[0])/(S0-Sd); //ä¸‹ä¸­ç‚¹å¾·å°”å¡”

        let distance=S0*(u*u-d*d); //Suå’ŒSdçš„è·ç¦»
        let delta=(PutV[2]-PutV[0])/distance;
        let gamma=2.0*(DeltaU-DeltaD)/distance;

        (PutV[1],delta,gamma)
    }
	```